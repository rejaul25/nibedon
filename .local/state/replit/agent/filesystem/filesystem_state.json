{"file_contents":{"README.md":{"content":"# Bhavki Membership Manager\n\nA complete, production-ready membership management system with chairman dashboard, member portal, payment tracking, investment management, share calculations, and full audit history.\n\n## Features\n\n### Core Functionality\n- **Chairman Dashboard**: Complete admin control panel for managing members, payments, investments, and viewing audit history\n- **Member Portal**: Bangla-language interface for members to view their profile, payment history, and investments\n- **Authentication**: Secure JWT-based authentication with httpOnly cookies\n- **Membership ID System**: Generate and manage unique membership IDs\n- **Payment Tracking**: Record, update, and track all member payments with transaction details\n- **Investment Management**: Create, update, and track organizational investments (chairman only, members can view)\n- **Audit History**: Complete tracking of all chairman actions with timestamps and change summaries\n- **Share Calculations**: Automated calculations for old members, new members, and \"new but full share\" members\n\n### Security Features\n- Auto-generated JWT secrets (no hardcoded tokens)\n- bcrypt password hashing\n- Rate limiting on authentication endpoints\n- Input validation with Zod\n- SQL injection protection\n- XSS prevention\n- Secure httpOnly cookies\n- Password reset via email\n\n## Technology Stack\n\n- **Frontend**: Next.js 14 with TypeScript, Tailwind CSS\n- **Backend**: Next.js API routes\n- **Database**: PostgreSQL with Prisma ORM\n- **Authentication**: JWT with secure httpOnly cookies\n- **Validation**: Zod\n- **Email**: Nodemailer\n- **Testing**: Jest\n\n## Setup Instructions\n\n### Prerequisites\n- Node.js 20 or higher\n- PostgreSQL database (automatically configured on Replit)\n\n### Installation\n\n1. **Install dependencies**:\n```bash\nnpm install\n```\n\n2. **Set up environment variables**:\nCreate a `.env` file based on `.env.example`:\n```bash\n# Database (automatically configured on Replit)\nDATABASE_URL=\"postgresql://...\"\n\n# JWT Secret (auto-generated if not provided)\nJWT_SECRET=\"\"\n\n# Chairman Account (for seeding)\nCHAIRMAN_USERNAME=\"chairman\"\nCHAIRMAN_PASSWORD=\"admin123\"\nCHAIRMAN_EMAIL=\"chairman@bhavki.com\"\nCHAIRMAN_NAME=\"Chairman Name\"\nCHAIRMAN_MOBILE=\"01700000000\"\n\n# Email Configuration (for password reset)\nSMTP_HOST=\"smtp.gmail.com\"\nSMTP_PORT=\"587\"\nSMTP_USER=\"your-email@gmail.com\"\nSMTP_PASS=\"your-app-password\"\nEMAIL_FROM=\"noreply@bhavki.com\"\n```\n\n3. **Set up the database**:\n```bash\nnpx prisma generate\nnpx prisma db push\n```\n\n4. **Seed the chairman account**:\n```bash\nnpm run seed:init\n```\n\n5. **Optional: Seed sample data**:\n```bash\nnpm run seed:sample\n```\n\n## How to Run\n\n### Development Mode\n```bash\nnpm run dev\n```\nThe application will be available at `http://localhost:5000`\n\n### Production Mode\n```bash\nnpm run build\nnpm start\n```\n\n### Run Tests\n```bash\nnpm test\n```\n\n## How to Use\n\n### Chairman Access\n\n1. **Login**: Navigate to `/chairman/login`\n   - Username: Use the `CHAIRMAN_USERNAME` from your `.env` file (default: `chairman`)\n   - Password: Use the `CHAIRMAN_PASSWORD` from your `.env` file (default: `admin123`)\n   - **⚠️ IMPORTANT**: Change the default password after first login!\n\n2. **Forgot Password**: Click \"Forgot Password?\" on the login page\n   - Requires SMTP configuration in `.env` file\n   - Reset link will be sent to `CHAIRMAN_EMAIL`\n   - Link expires in 1 hour\n\n3. **Dashboard Features**:\n   - **Members Tab**: Manage all members\n     - Generate membership IDs\n     - Create new members (select \"Full Share\" or \"New Member\")\n     - Search members by name or membership ID\n     - Edit member details (except membership ID)\n     - Delete members (cascades to payments, marks membership ID as unusable)\n   - **Payments Tab**: Record and manage payments\n     - Create single or bulk payments\n     - Update payment details including transaction number\n     - View all payment history\n   - **Investments Tab**: Manage organizational investments\n     - Create new investments (title, description, amount, purpose)\n     - Update investment details\n     - Delete investments\n   - **Audit Tab**: View complete history of all chairman actions\n\n### Member Access\n\n1. **Registration**: Navigate to `/member/register`\n   - Requires a valid membership ID (generated by chairman)\n   - Fill in: Name (নাম), Father's Name (পিতার নাম), Mobile (মোবাইল নম্বর), Password (পাসওয়ার্ড)\n   - Membership ID can only be used once\n   - After successful registration, automatically redirected to login\n\n2. **Login**: Navigate to `/member/login`\n   - Membership ID (মেম্বারশিপ আইডি)\n   - Password (পাসওয়ার্ড)\n\n3. **Dashboard Features**:\n   - **Profile**: View personal information\n   - **Payment History**: Complete timeline of all payments (first to latest)\n   - **Investments**: View all organizational investments with details\n\n## Share Calculation Formulas\n\n### Formula Explanation (English & Bangla)\n\n#### For Old (Full Share) Members:\n**Formula**: `share = 500 × months_paid × 100 / (total_shares × total_months) × 500`\n\n**English**: An old member's share is calculated based on their months of payment relative to the total share-months of all full-share members.\n\n**বাংলা**: পুরাতন সদস্যদের শেয়ার তাদের মোট পেমেন্ট মাস এবং সকল ফুল শেয়ার সদস্যদের মোট শেয়ার-মাসের ভিত্তিতে গণনা করা হয়।\n\n#### For New Members:\n**Formula**: `share = 500 × months_paid × 100 / (previous_total + new_month_total)`\n\n**English**: A new member's share is calculated based on their contribution relative to the total accumulated funds (previous + current).\n\n**বাংলা**: নতুন সদস্যদের শেয়ার তাদের অবদান এবং মোট সংগৃহীত তহবিলের (পূর্বের + বর্তমান) ভিত্তিতে গণনা করা হয়।\n\n#### For \"New but Full Share\" Members:\n**English**: When creating a member as \"New but Full Share\", the system automatically calculates the required upfront payment: `500 × (months existing members have paid)`. This payment is recorded automatically, giving them equal standing with existing full-share members.\n\n**বাংলা**: \"নতুন তবে ফুল শেয়ার\" সদস্য তৈরি করার সময়, সিস্টেম স্বয়ংক্রিয়ভাবে প্রয়োজনীয় অগ্রিম পেমেন্ট গণনা করে: `৫০০ × (বিদ্যমান সদস্যদের পেমেন্ট মাস সংখ্যা)`। এই পেমেন্ট স্বয়ংক্রিয়ভাবে রেকর্ড হয়, যা তাদের বিদ্যমান ফুল শেয়ার সদস্যদের সমান মর্যাদা দেয়।\n\n## API Endpoints\n\n### Authentication\n- `POST /api/auth/chairman/login` - Chairman login\n- `POST /api/auth/chairman/forgot-password` - Request password reset\n- `POST /api/auth/reset-password` - Reset password with token\n- `POST /api/auth/member/register` - Member registration (requires valid membership ID)\n- `POST /api/auth/member/login` - Member login\n- `POST /api/auth/logout` - Logout (clears cookie)\n- `GET /api/auth/me` - Get current user info\n\n### Membership IDs\n- `POST /api/membership-ids/generate` - Generate membership IDs (chairman only)\n\n### Members\n- `GET /api/members` - List all members with search and pagination (chairman only)\n- `POST /api/members` - Create new member (chairman only)\n- `GET /api/members/[id]` - Get member details (owner or chairman)\n- `PUT /api/members/[id]` - Update member (owner or chairman)\n- `DELETE /api/members/[id]` - Delete member with cascade (chairman only)\n\n### Payments\n- `GET /api/payments` - List all payments (chairman only)\n- `POST /api/payments` - Create payment (chairman only)\n- `PUT /api/payments/[id]` - Update payment including transaction number (chairman only)\n- `GET /api/payments/member/[membershipId]` - Get member payments (owner or chairman)\n\n### Investments\n- `GET /api/investments` - List all investments (all authenticated users)\n- `POST /api/investments` - Create investment (chairman only)\n- `PUT /api/investments/[id]` - Update investment (chairman only)\n- `DELETE /api/investments/[id]` - Delete investment (chairman only)\n\n### Reports & Audit\n- `GET /api/reports/share` - Get share calculations for all members\n- `GET /api/audit-logs` - View audit history (chairman only)\n\n## Database Schema\n\n### User\n- Stores both chairman and members\n- `membershipId`: Unique, immutable identifier\n- `role`: chairman | member\n- `shareType`: fullShare | newMember (for members only)\n- `isDeleted`: Soft delete flag\n\n### Payment\n- Linked to member via `membershipId`\n- Tracks: amount, date, payment method, transaction number\n- `updatedBy`: Tracks who made edits (audit trail)\n- Cascade deletes when member is deleted\n\n### MembershipId\n- Pool of generated membership IDs\n- `assignedTo`: Links to user when used\n- `isDeleted`: Prevents reuse of deleted member IDs\n\n### Investment\n- Organizational investments\n- Viewable by all members, editable by chairman only\n- Tracks: title, description, amount, date, purpose\n\n### AuditLog\n- Complete history of all chairman actions\n- Tracks: action type, performer, target, changes, metadata\n- Immutable record\n\n### PasswordResetToken\n- For chairman password recovery\n- Tokens expire in 1 hour\n- One-time use only\n\n## Important Notes\n\n### Member Deletion\nWhen a chairman deletes a member:\n1. User record is soft-deleted (`isDeleted = true`)\n2. All payment records are cascade deleted\n3. Membership ID is marked as deleted (`isDeleted = true`)\n4. **The membership ID becomes permanently unusable** and cannot be reassigned\n\n### Payment Editing\n- Chairman can edit **any field** of any payment at any time\n- Common use case: Adding transaction number to existing payments\n- All edits are tracked in the audit log with:\n  - Who made the change\n  - When it was changed\n  - What was changed (before → after)\n\n### Share Type Selection\nWhen creating a member, chairman selects:\n- **Full Share**: For members joining with equal status (auto-calculates upfront payment)\n- **New Member**: For members starting fresh with gradual contribution\n\n### JWT Secret\n- If `JWT_SECRET` is not provided in `.env`, one will be auto-generated\n- **For production**: Always set a permanent `JWT_SECRET` in your environment\n- Auto-generated secrets will change on restart, invalidating all sessions\n\n### Email Configuration\n- Required for chairman password reset\n- Use Gmail App Passwords or other SMTP service\n- Without email config, forgot-password feature won't work\n\n## Development\n\n### Project Structure\n```\n├── pages/\n│   ├── api/              # API routes\n│   ├── chairman/         # Chairman pages\n│   ├── member/           # Member pages\n│   └── index.tsx         # Homepage\n├── lib/                  # Utilities\n│   ├── prisma.ts         # Database client\n│   ├── jwt.ts            # JWT utilities\n│   ├── auth.ts           # Auth helpers\n│   ├── share-calculator.ts\n│   ├── audit.ts\n│   ├── email.ts\n│   ├── rate-limiter.ts\n│   └── validation.ts\n├── prisma/\n│   └── schema.prisma     # Database schema\n├── scripts/              # Seed scripts\n└── __tests__/            # Jest tests\n```\n\n### Environment Variables\nSee `.env.example` for all available configuration options.\n\n### Database Migrations\nThis project uses Prisma's push workflow:\n```bash\nnpx prisma db push\n```\n\nFor production, consider using migrations:\n```bash\nnpx prisma migrate dev\n```\n\n## Security Considerations\n\n1. **Always change default chairman password** after first login\n2. **Set a strong JWT_SECRET** in production\n3. **Configure rate limiting** appropriately for your environment\n4. **Use HTTPS** in production\n5. **Secure your SMTP credentials**\n6. **Regularly review audit logs** for suspicious activity\n7. **Keep dependencies updated** for security patches\n\n## Troubleshooting\n\n### Chairman Cannot Login\n- Verify chairman account was created: `npm run seed:init`\n- Check username/password match `.env` values\n- Clear browser cookies and try again\n\n### Member Registration Fails\n- Ensure membership ID was generated by chairman\n- Check that membership ID hasn't been used before\n- Verify membership ID hasn't been marked as deleted\n\n### Forgot Password Not Working\n- Verify SMTP configuration in `.env`\n- Check email spam folder\n- Ensure `CHAIRMAN_EMAIL` is correct\n- Check server logs for email errors\n\n### Database Connection Issues\n- Verify `DATABASE_URL` is correct\n- Run `npx prisma db push` to sync schema\n- Check PostgreSQL service is running\n\n## License\n\nThis project is proprietary software for Bhavki Membership Manager.\n\n## Support\n\nFor issues or questions, contact the system administrator.\n\n---\n\n**Last Updated**: November 2025\n**Version**: 1.0.0\n","size_bytes":13266},"pages/api/auth/logout.ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport { clearAuthCookie } from '@/lib/auth'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' })\n  }\n\n  clearAuthCookie(res)\n  return res.status(200).json({ message: 'Logged out successfully' })\n}\n","size_bytes":391},"lib/share-calculator.ts":{"content":"import { prisma } from './prisma'\n\nexport interface ShareCalculation {\n  membershipId: string\n  name: string\n  shareType: 'fullShare' | 'newMember'\n  totalPaid: number\n  sharePercentage: number\n  monthsPaid: number\n}\n\nexport const calculateOldMemberShare = (\n  monthsPaid: number,\n  totalShares: number,\n  totalMonths: number\n): number => {\n  if (totalShares === 0 || totalMonths === 0) return 0\n  return (monthsPaid / totalShares) * 100\n}\n\nexport const calculateNewMemberShare = (\n  monthsPaid: number,\n  previousTotal: number,\n  newMonthTotal: number\n): number => {\n  const memberContribution = 500 * monthsPaid\n  const totalFund = previousTotal + newMonthTotal\n  if (totalFund === 0) return 0\n  return (memberContribution / totalFund) * 100\n}\n\nexport const calculateFullShareUpfrontPayment = async (): Promise<number> => {\n  const existingMembers = await prisma.user.findMany({\n    where: {\n      role: 'member',\n      isDeleted: false,\n    },\n    include: {\n      payments: true,\n    },\n  })\n\n  if (existingMembers.length === 0) {\n    return 500\n  }\n\n  const maxMonths = Math.max(\n    ...existingMembers.map((m) => m.payments.length)\n  )\n\n  return 500 * maxMonths\n}\n\nexport const calculateAllShares = async (): Promise<ShareCalculation[]> => {\n  const members = await prisma.user.findMany({\n    where: {\n      role: 'member',\n      isDeleted: false,\n    },\n    include: {\n      payments: {\n        orderBy: {\n          date: 'asc',\n        },\n      },\n    },\n  })\n\n  if (members.length === 0) {\n    return []\n  }\n\n  const calculations: ShareCalculation[] = []\n  let totalShares = 0\n\n  for (const member of members) {\n    const totalPaid = member.payments.reduce((sum, p) => sum + p.amount, 0)\n    const monthsPaid = member.payments.length\n\n    if (member.shareType === 'fullShare') {\n      totalShares += monthsPaid\n    }\n  }\n\n  const totalMonths = Math.max(...members.map((m) => m.payments.length))\n\n  for (const member of members) {\n    const totalPaid = member.payments.reduce((sum, p) => sum + p.amount, 0)\n    const monthsPaid = member.payments.length\n\n    let sharePercentage = 0\n\n    if (member.shareType === 'fullShare') {\n      sharePercentage = calculateOldMemberShare(\n        monthsPaid,\n        totalShares,\n        totalMonths\n      )\n    } else if (member.shareType === 'newMember') {\n      const allPayments = await prisma.payment.findMany({\n        where: {\n          date: {\n            lt: member.createdAt,\n          },\n        },\n      })\n      const previousTotal = allPayments.reduce((sum, p) => sum + p.amount, 0)\n      \n      const memberPayments = member.payments\n      const newMonthTotal = memberPayments.reduce((sum, p) => sum + p.amount, 0)\n\n      sharePercentage = calculateNewMemberShare(\n        monthsPaid,\n        previousTotal,\n        newMonthTotal\n      )\n    }\n\n    calculations.push({\n      membershipId: member.membershipId,\n      name: member.name,\n      shareType: member.shareType || 'newMember',\n      totalPaid,\n      sharePercentage,\n      monthsPaid,\n    })\n  }\n\n  return calculations\n}\n","size_bytes":3039},"pages/api/auth/reset-password.ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport bcrypt from 'bcrypt'\nimport { prisma } from '@/lib/prisma'\nimport { resetPasswordSchema } from '@/lib/validation'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' })\n  }\n\n  try {\n    const validation = resetPasswordSchema.safeParse(req.body)\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error.errors[0].message })\n    }\n\n    const { token, password } = validation.data\n\n    const resetToken = await prisma.passwordResetToken.findUnique({\n      where: { token },\n      include: { user: true },\n    })\n\n    if (!resetToken || resetToken.used || resetToken.expiresAt < new Date()) {\n      return res.status(400).json({ error: 'Invalid or expired token' })\n    }\n\n    const passwordHash = await bcrypt.hash(password, 10)\n\n    await prisma.$transaction([\n      prisma.user.update({\n        where: { id: resetToken.userId },\n        data: { passwordHash },\n      }),\n      prisma.passwordResetToken.update({\n        where: { id: resetToken.id },\n        data: { used: true },\n      }),\n    ])\n\n    return res.status(200).json({ message: 'Password reset successful' })\n  } catch (error) {\n    console.error('Reset password error:', error)\n    return res.status(500).json({ error: 'Internal server error' })\n  }\n}\n","size_bytes":1447},"lib/audit.ts":{"content":"import { prisma } from './prisma'\nimport { AuditAction } from '@prisma/client'\n\nexport const createAuditLog = async (\n  action: AuditAction,\n  performedBy: string,\n  targetType: string,\n  targetId: string | null,\n  changeSummary: string,\n  metadata?: Record<string, any>\n): Promise<void> => {\n  await prisma.auditLog.create({\n    data: {\n      action,\n      performedBy,\n      targetType,\n      targetId,\n      changeSummary,\n      metadata: metadata ? JSON.stringify(metadata) : null,\n    },\n  })\n}\n\nexport const getAuditLogs = async (\n  limit = 100,\n  offset = 0\n) => {\n  return await prisma.auditLog.findMany({\n    take: limit,\n    skip: offset,\n    orderBy: {\n      createdAt: 'desc',\n    },\n    include: {\n      user: {\n        select: {\n          name: true,\n          membershipId: true,\n        },\n      },\n    },\n  })\n}\n","size_bytes":829},"pages/api/investments/[id].ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport { prisma } from '@/lib/prisma'\nimport { requireAuth } from '@/lib/auth'\nimport { updateInvestmentSchema } from '@/lib/validation'\nimport { createAuditLog } from '@/lib/audit'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  const { id } = req.query\n  const auth = requireAuth(req, res, ['chairman'])\n  if (!auth) return\n\n  if (req.method === 'PUT') {\n    try {\n      const investment = await prisma.investment.findUnique({\n        where: { id: String(id) },\n      })\n\n      if (!investment) {\n        return res.status(404).json({ error: 'Investment not found' })\n      }\n\n      const validation = updateInvestmentSchema.safeParse(req.body)\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error.errors[0].message })\n      }\n\n      const updateData: any = { updatedBy: auth.userId }\n      const changes: string[] = []\n\n      if (validation.data.title) {\n        updateData.title = validation.data.title\n        changes.push(`title: ${investment.title} → ${validation.data.title}`)\n      }\n      if (validation.data.description) {\n        updateData.description = validation.data.description\n        changes.push('description updated')\n      }\n      if (validation.data.amount !== undefined) {\n        updateData.amount = validation.data.amount\n        changes.push(`amount: ${investment.amount} → ${validation.data.amount}`)\n      }\n      if (validation.data.date) {\n        updateData.date = new Date(validation.data.date)\n        changes.push('date updated')\n      }\n      if (validation.data.purpose) {\n        updateData.purpose = validation.data.purpose\n        changes.push('purpose updated')\n      }\n\n      const updated = await prisma.investment.update({\n        where: { id: String(id) },\n        data: updateData,\n      })\n\n      await createAuditLog(\n        'INVESTMENT_UPDATED',\n        auth.userId,\n        'Investment',\n        investment.id,\n        `Updated investment: ${investment.title} - ${changes.join(', ')}`,\n        { changes }\n      )\n\n      return res.status(200).json({ investment: updated })\n    } catch (error) {\n      console.error('Update investment error:', error)\n      return res.status(500).json({ error: 'Internal server error' })\n    }\n  }\n\n  if (req.method === 'DELETE') {\n    try {\n      const investment = await prisma.investment.findUnique({\n        where: { id: String(id) },\n      })\n\n      if (!investment) {\n        return res.status(404).json({ error: 'Investment not found' })\n      }\n\n      await prisma.investment.delete({\n        where: { id: String(id) },\n      })\n\n      await createAuditLog(\n        'INVESTMENT_DELETED',\n        auth.userId,\n        'Investment',\n        investment.id,\n        `Deleted investment: ${investment.title} - ${investment.amount} BDT`,\n        { title: investment.title, amount: investment.amount }\n      )\n\n      return res.status(200).json({ message: 'Investment deleted successfully' })\n    } catch (error) {\n      console.error('Delete investment error:', error)\n      return res.status(500).json({ error: 'Internal server error' })\n    }\n  }\n\n  return res.status(405).json({ error: 'Method not allowed' })\n}\n","size_bytes":3251},"__tests__/share-calculator.test.ts":{"content":"import { calculateOldMemberShare, calculateNewMemberShare } from '../lib/share-calculator'\n\ndescribe('Share Calculator', () => {\n  describe('calculateOldMemberShare', () => {\n    it('should calculate 30% share for member with 6 months out of 20 total shares', () => {\n      const monthsPaid = 6\n      const totalShares = 20\n      const totalMonths = 6\n      \n      const result = calculateOldMemberShare(monthsPaid, totalShares, totalMonths)\n      \n      expect(result).toBe(30)\n    })\n\n    it('should calculate 50% share when member paid half of total shares', () => {\n      const monthsPaid = 10\n      const totalShares = 20\n      const totalMonths = 10\n      \n      const result = calculateOldMemberShare(monthsPaid, totalShares, totalMonths)\n      \n      expect(result).toBe(50)\n    })\n\n    it('should calculate 100% share when member is the only one', () => {\n      const monthsPaid = 12\n      const totalShares = 12\n      const totalMonths = 12\n      \n      const result = calculateOldMemberShare(monthsPaid, totalShares, totalMonths)\n      \n      expect(result).toBe(100)\n    })\n\n    it('should return 0 when monthsPaid is 0', () => {\n      const result = calculateOldMemberShare(0, 20, 6)\n      expect(result).toBe(0)\n    })\n\n    it('should return 0 when totalShares is 0', () => {\n      const result = calculateOldMemberShare(6, 0, 6)\n      expect(result).toBe(0)\n    })\n  })\n\n  describe('calculateNewMemberShare', () => {\n    it('should calculate 2.439% share for member with 1500 contribution out of 61500 total', () => {\n      const monthsPaid = 3\n      const previousTotal = 60000\n      const newMonthTotal = 1500\n      \n      const result = calculateNewMemberShare(monthsPaid, previousTotal, newMonthTotal)\n      \n      expect(result).toBeCloseTo(2.439, 2)\n    })\n\n    it('should calculate 1.639% share for member with 1000 contribution out of 61000 total', () => {\n      const monthsPaid = 2\n      const previousTotal = 60000\n      const newMonthTotal = 1000\n      \n      const result = calculateNewMemberShare(monthsPaid, previousTotal, newMonthTotal)\n      \n      expect(result).toBeCloseTo(1.639, 2)\n    })\n\n    it('should calculate 100% share when member is first and only contributor', () => {\n      const monthsPaid = 6\n      const previousTotal = 0\n      const newMonthTotal = 3000\n      \n      const result = calculateNewMemberShare(monthsPaid, previousTotal, newMonthTotal)\n      \n      expect(result).toBe(100)\n    })\n\n    it('should return 0 when monthsPaid is 0', () => {\n      const result = calculateNewMemberShare(0, 60000, 1500)\n      expect(result).toBe(0)\n    })\n\n    it('should return 0 when total fund is 0', () => {\n      const result = calculateNewMemberShare(3, 0, 0)\n      expect(result).toBe(0)\n    })\n  })\n})\n","size_bytes":2750},"lib/rate-limiter.ts":{"content":"import { NextApiRequest, NextApiResponse } from 'next'\n\ninterface RateLimitStore {\n  [key: string]: {\n    count: number\n    resetTime: number\n  }\n}\n\nconst store: RateLimitStore = {}\n\nconst WINDOW_MS = 15 * 60 * 1000\nconst MAX_REQUESTS = 5\n\nexport const rateLimit = (\n  req: NextApiRequest,\n  res: NextApiResponse\n): boolean => {\n  const ip = req.headers['x-forwarded-for'] || req.socket.remoteAddress || 'unknown'\n  const key = `${ip}-${req.url}`\n  const now = Date.now()\n\n  if (!store[key] || now > store[key].resetTime) {\n    store[key] = {\n      count: 1,\n      resetTime: now + WINDOW_MS,\n    }\n    return true\n  }\n\n  store[key].count++\n\n  if (store[key].count > MAX_REQUESTS) {\n    res.status(429).json({\n      error: 'Too many requests, please try again later',\n    })\n    return false\n  }\n\n  return true\n}\n\nsetInterval(() => {\n  const now = Date.now()\n  Object.keys(store).forEach((key) => {\n    if (now > store[key].resetTime) {\n      delete store[key]\n    }\n  })\n}, WINDOW_MS)\n","size_bytes":986},"scripts/seed-chairman.ts":{"content":"import { PrismaClient } from '@prisma/client'\nimport bcrypt from 'bcrypt'\n\nconst prisma = new PrismaClient()\n\nasync function main() {\n  const username = process.env.CHAIRMAN_USERNAME || 'chairman'\n  const password = process.env.CHAIRMAN_PASSWORD || 'admin123'\n  const name = process.env.CHAIRMAN_NAME || 'Chairman'\n  const email = process.env.CHAIRMAN_EMAIL || 'chairman@bhavki.com'\n  const mobile = process.env.CHAIRMAN_MOBILE || '01700000000'\n\n  const existingChairman = await prisma.user.findFirst({\n    where: { role: 'chairman' },\n  })\n\n  if (existingChairman) {\n    console.log('Chairman account already exists')\n    return\n  }\n\n  const passwordHash = await bcrypt.hash(password, 10)\n\n  const chairman = await prisma.user.create({\n    data: {\n      membershipId: username,\n      name,\n      fatherName: 'N/A',\n      mobile,\n      email,\n      passwordHash,\n      role: 'chairman',\n    },\n  })\n\n  console.log('Chairman account created successfully!')\n  console.log('Username:', username)\n  console.log('Password:', password)\n  console.log('Email:', email)\n  console.log('\\n⚠️  IMPORTANT: Change the default password after first login!')\n}\n\nmain()\n  .then(async () => {\n    await prisma.$disconnect()\n  })\n  .catch(async (e) => {\n    console.error(e)\n    await prisma.$disconnect()\n    process.exit(1)\n  })\n","size_bytes":1315},"next-env.d.ts":{"content":"/// <reference types=\"next\" />\n/// <reference types=\"next/image-types/global\" />\n\n// NOTE: This file should not be edited\n// see https://nextjs.org/docs/pages/building-your-application/configuring/typescript for more information.\n","size_bytes":230},"pages/api/auth/member/login.ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport bcrypt from 'bcrypt'\nimport { prisma } from '@/lib/prisma'\nimport { generateToken } from '@/lib/jwt'\nimport { setAuthCookie } from '@/lib/auth'\nimport { memberLoginSchema } from '@/lib/validation'\nimport { rateLimit } from '@/lib/rate-limiter'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' })\n  }\n\n  if (!rateLimit(req, res)) {\n    return\n  }\n\n  try {\n    const validation = memberLoginSchema.safeParse(req.body)\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error.errors[0].message })\n    }\n\n    const { membershipId, password } = validation.data\n\n    const user = await prisma.user.findFirst({\n      where: {\n        membershipId,\n        role: 'member',\n        isDeleted: false,\n      },\n    })\n\n    if (!user) {\n      return res.status(401).json({ error: 'Invalid credentials' })\n    }\n\n    const isValidPassword = await bcrypt.compare(password, user.passwordHash)\n    if (!isValidPassword) {\n      return res.status(401).json({ error: 'Invalid credentials' })\n    }\n\n    const token = generateToken({\n      userId: user.id,\n      membershipId: user.membershipId,\n      role: user.role,\n    })\n\n    setAuthCookie(res, token)\n\n    return res.status(200).json({\n      user: {\n        id: user.id,\n        name: user.name,\n        membershipId: user.membershipId,\n        role: user.role,\n      },\n    })\n  } catch (error) {\n    console.error('Member login error:', error)\n    return res.status(500).json({ error: 'Internal server error' })\n  }\n}\n","size_bytes":1692},"pages/api/payments/index.ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport { prisma } from '@/lib/prisma'\nimport { requireAuth } from '@/lib/auth'\nimport { createPaymentSchema } from '@/lib/validation'\nimport { createAuditLog } from '@/lib/audit'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method === 'GET') {\n    const auth = requireAuth(req, res, ['chairman'])\n    if (!auth) return\n\n    try {\n      const { page = 1, limit = 50 } = req.query\n      const skip = (Number(page) - 1) * Number(limit)\n\n      const [payments, total] = await Promise.all([\n        prisma.payment.findMany({\n          skip,\n          take: Number(limit),\n          orderBy: { date: 'desc' },\n          include: {\n            member: {\n              select: {\n                name: true,\n                membershipId: true,\n              },\n            },\n          },\n        }),\n        prisma.payment.count(),\n      ])\n\n      return res.status(200).json({\n        payments,\n        pagination: {\n          total,\n          page: Number(page),\n          limit: Number(limit),\n          pages: Math.ceil(total / Number(limit)),\n        },\n      })\n    } catch (error) {\n      console.error('Get payments error:', error)\n      return res.status(500).json({ error: 'Internal server error' })\n    }\n  }\n\n  if (req.method === 'POST') {\n    const auth = requireAuth(req, res, ['chairman'])\n    if (!auth) return\n\n    try {\n      const validation = createPaymentSchema.safeParse(req.body)\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error.errors[0].message })\n      }\n\n      const { membershipId, amount, date, paymentFrom, transactionNumber } = validation.data\n\n      const member = await prisma.user.findFirst({\n        where: {\n          membershipId,\n          role: 'member',\n          isDeleted: false,\n        },\n      })\n\n      if (!member) {\n        return res.status(404).json({ error: 'Member not found' })\n      }\n\n      const payment = await prisma.payment.create({\n        data: {\n          membershipId,\n          amount,\n          date: new Date(date),\n          paymentFrom,\n          transactionNumber: transactionNumber || null,\n          createdById: auth.userId,\n        },\n      })\n\n      await createAuditLog(\n        'PAYMENT_CREATED',\n        auth.userId,\n        'Payment',\n        payment.id,\n        `Created payment: ${amount} BDT for ${membershipId} via ${paymentFrom}`,\n        { membershipId, amount, paymentFrom, transactionNumber }\n      )\n\n      return res.status(201).json({ payment })\n    } catch (error) {\n      console.error('Create payment error:', error)\n      return res.status(500).json({ error: 'Internal server error' })\n    }\n  }\n\n  return res.status(405).json({ error: 'Method not allowed' })\n}\n","size_bytes":2808},"lib/prisma.ts":{"content":"import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = global as unknown as { prisma: PrismaClient }\n\nexport const prisma =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    log: process.env.NODE_ENV === 'development' ? ['error', 'warn'] : ['error'],\n  })\n\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\n","size_bytes":351},"replit.md":{"content":"# Bhavki Membership Manager\n\n## Overview\n\nBhavki Membership Manager is a complete membership management system designed for organizational membership tracking, payment management, and investment oversight. The application supports two distinct user roles: a chairman (administrator) who manages all aspects of the organization, and members who can view their own information and payment history through a Bangla-language interface.\n\nThe system provides comprehensive features including membership ID generation, payment tracking with transaction details, investment management, automated share calculations for different member types, and complete audit history of all administrative actions.\n\n## Recent Changes\n\n### November 9, 2025 - Critical Share Calculation Fix\n- **Fixed critical bug in share calculation formulas** that was multiplying the base amount (500 Taka) twice\n- **Old member formula corrected**: Now properly calculates as `(monthsPaid / totalShares) × 100` to return percentage (0-100%)\n- **New member formula corrected**: Now properly calculates as `(memberContribution / totalFund) × 100` to return percentage (0-100%)\n- **Updated Jest tests** with concrete expected values instead of placeholder assertions\n- **All 10 tests passing** with verified accuracy for multiple scenarios including edge cases\n- **Formulas now produce mathematically correct percentage values** representing each member's proportional share\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Framework**: Next.js 14 with TypeScript, server-side rendering, and API routes\n- **Styling**: Tailwind CSS with custom theme configuration and responsive design\n- **Form Management**: React Hook Form for form state and validation\n- **Date Handling**: date-fns library for date formatting and manipulation\n- **Pages Structure**: Separate page hierarchies for chairman (`/chairman/*`) and member (`/member/*`) portals\n\n**Design Decisions**:\n- Bangla language interface for member portal to improve accessibility for local users\n- Separate login flows for chairman and members with different authentication requirements\n- Dashboard-based interfaces for both roles with role-specific information display\n- Client-side form validation with server-side verification for security\n\n### Backend Architecture\n\n**API Structure**: Next.js API routes (`/pages/api/*`)\n- **Authentication**: JWT tokens stored in httpOnly secure cookies\n- **Database ORM**: Prisma Client for type-safe database queries\n- **Validation**: Zod schemas for request validation across all endpoints\n- **Rate Limiting**: In-memory rate limiter for authentication endpoints (15-minute windows, 5 requests max)\n- **Audit Logging**: Complete tracking of all chairman actions with timestamps and change details\n\n**Security Measures**:\n- bcrypt password hashing (10 rounds)\n- httpOnly cookies for token storage to prevent XSS attacks\n- Secure headers configuration in next.config.js (HSTS, X-Frame-Options, CSP-related headers)\n- SQL injection protection through Prisma's parameterized queries\n- Input validation on all endpoints using Zod schemas\n- Rate limiting on sensitive endpoints (login, password reset)\n- Password reset tokens with 1-hour expiration\n\n**Core API Endpoints**:\n- `/api/auth/*` - Authentication (login, logout, registration, password reset)\n- `/api/members/*` - Member CRUD operations (chairman only for write operations)\n- `/api/payments/*` - Payment tracking and history\n- `/api/investments/*` - Investment management (chairman creates, members view)\n- `/api/membership-ids/*` - Membership ID generation and management\n- `/api/audit-logs/*` - Audit history viewing (chairman only)\n- `/api/reports/*` - Share calculation reports\n\n### Data Architecture\n\n**Database**: PostgreSQL (configured for Neon serverless in production via `server/db.ts`)\n\n**ORM Layer**: Dual approach detected:\n- Prisma ORM (primary) - Used throughout the application\n- Drizzle ORM setup (in `server/db.ts`) - May be added later for specific use cases\n\n**Key Data Models** (Prisma Schema):\n- `User` - Both chairman and member accounts with role differentiation, membership IDs, share types\n- `Payment` - Payment records with member references, transaction details, audit fields\n- `Investment` - Organizational investments with full details and audit tracking\n- `MembershipId` - Pool of generated IDs with assignment tracking and soft deletion\n- `PasswordResetToken` - Secure password reset mechanism with expiration\n- `AuditLog` - Complete action history with performer, target, and change details\n\n**Share Calculation Logic**:\n- Old members (fullShare): Calculated as percentage of total shares based on months paid\n- New members: Calculated as contribution amount divided by total fund\n- \"New but full share\": One-time upfront payment calculated based on existing member payments\n- Share calculations are read-only operations computed on-demand\n\n**Data Integrity**:\n- Soft deletion pattern for users (isDeleted flag) to maintain payment history\n- Cascade behavior: Deleting a member marks associated MembershipId as deleted\n- Unique constraints on membershipId and mobile numbers\n- Transaction support for multi-step operations (user creation with ID assignment)\n\n### Authentication & Authorization\n\n**JWT Implementation**:\n- Auto-generated JWT secret (with fallback generation if not in environment)\n- 7-day token expiration\n- Payload includes: userId, membershipId, role\n- Secure cookie configuration with SameSite=strict, httpOnly flags\n\n**Role-Based Access Control**:\n- Chairman: Full access to all endpoints, can create/edit/delete members and payments\n- Member: Read-only access to own profile and payment history, view-only access to investments\n- Middleware function `requireAuth()` enforces role requirements on protected endpoints\n\n**Password Management**:\n- Chairman-only password reset via email\n- Reset tokens expire after 1 hour\n- Tokens marked as used after successful reset\n- Members cannot self-reset passwords (must contact chairman)\n\n### External Dependencies\n\n**Database Services**:\n- PostgreSQL database (Neon serverless via `@neondatabase/serverless`)\n- Connection pooling configured for serverless environments\n- WebSocket support for Neon database connections\n\n**Email Service**:\n- Nodemailer for SMTP email delivery\n- Configurable SMTP settings (host, port, credentials)\n- Used for chairman password reset functionality\n- HTML email templates for professional appearance\n\n**Third-Party NPM Packages**:\n- `@prisma/client` - Database ORM\n- `bcrypt` - Password hashing\n- `jsonwebtoken` - JWT token generation and verification\n- `zod` - Schema validation\n- `cookie` - Cookie parsing and serialization\n- `next` - React framework\n- `react-hook-form` - Form state management\n- `date-fns` - Date manipulation\n- `nodemailer` - Email sending\n- `tailwindcss` - CSS framework\n\n**Development Dependencies**:\n- `prisma` - Database schema management and migrations\n- `typescript` - Type safety\n- `jest` & `ts-jest` - Testing framework\n- `ts-node` - TypeScript execution for seed scripts\n- `autoprefixer` & `postcss` - CSS processing\n\n**Testing Infrastructure**:\n- Jest configured with ts-jest preset\n- Unit tests for share calculation logic\n- Test files located in `__tests__/` directory\n- Module path aliasing (`@/*`) configured for imports\n\n**Seed Scripts**:\n- `scripts/seed-chairman.ts` - Creates initial chairman account\n- `scripts/seed-sample.ts` - Generates sample members and payments for testing\n- Both support environment variable configuration","size_bytes":7587},"jest.config.js":{"content":"module.exports = {\n  preset: 'ts-jest',\n  testEnvironment: 'node',\n  moduleNameMapper: {\n    '^@/(.*)$': '<rootDir>/$1',\n  },\n  testMatch: ['**/__tests__/**/*.test.ts'],\n}\n","size_bytes":172},"postcss.config.js":{"content":"module.exports = {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":82},"lib/auth.ts":{"content":"import { serialize, parse } from 'cookie'\nimport { verifyToken, JWTPayload } from './jwt'\nimport { NextApiRequest, NextApiResponse } from 'next'\n\nconst COOKIE_NAME = 'auth_token'\n\nexport const setAuthCookie = (res: NextApiResponse, token: string) => {\n  const cookie = serialize(COOKIE_NAME, token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'strict',\n    maxAge: 7 * 24 * 60 * 60,\n    path: '/',\n  })\n  res.setHeader('Set-Cookie', cookie)\n}\n\nexport const clearAuthCookie = (res: NextApiResponse) => {\n  const cookie = serialize(COOKIE_NAME, '', {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === 'production',\n    sameSite: 'strict',\n    maxAge: 0,\n    path: '/',\n  })\n  res.setHeader('Set-Cookie', cookie)\n}\n\nexport const getAuthToken = (req: NextApiRequest): string | null => {\n  const cookies = parse(req.headers.cookie || '')\n  return cookies[COOKIE_NAME] || null\n}\n\nexport const verifyAuth = (req: NextApiRequest): JWTPayload | null => {\n  const token = getAuthToken(req)\n  if (!token) return null\n  return verifyToken(token)\n}\n\nexport const requireAuth = (\n  req: NextApiRequest,\n  res: NextApiResponse,\n  allowedRoles?: ('chairman' | 'member')[]\n): JWTPayload | null => {\n  const payload = verifyAuth(req)\n  \n  if (!payload) {\n    res.status(401).json({ error: 'Unauthorized' })\n    return null\n  }\n  \n  if (allowedRoles && !allowedRoles.includes(payload.role)) {\n    res.status(403).json({ error: 'Forbidden' })\n    return null\n  }\n  \n  return payload\n}\n","size_bytes":1515},"pages/member/login.tsx":{"content":"import { useState } from \"react\";\nimport Head from \"next/head\";\nimport { useRouter } from \"next/router\";\nimport Link from \"next/link\";\n\nexport default function MemberLogin() {\n  const router = useRouter();\n  const [formData, setFormData] = useState({ membershipId: \"\", password: \"\" });\n  const [error, setError] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    setLoading(true);\n\n    try {\n      const res = await fetch(\"/api/auth/member/login\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(formData),\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) {\n        throw new Error(data.error || \"Login failed\");\n      }\n\n      router.push(\"/member/dashboard\");\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <>\n      <Head>\n        <title>সদস্য লগইন - Bhavki Membership Manager</title>\n      </Head>\n      <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center p-4\">\n        <div className=\"bg-white rounded-lg shadow-xl p-8 w-full max-w-md\">\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-3xl font-bold text-gray-900\">সদস্য লগইন</h1>\n            <p className=\"text-gray-600 mt-2\">আপনার অ্যাকাউন্টে প্রবেশ করুন</p>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {error && (\n              <div className=\"bg-red-50 text-red-800 p-3 rounded border border-red-200\">\n                {error}\n              </div>\n            )}\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                মেম্বারশিপ আইডি\n              </label>\n              <input\n                type=\"text\"\n                value={formData.membershipId}\n                onChange={(e) =>\n                  setFormData({ ...formData, membershipId: e.target.value })\n                }\n                className=\"w-full text-black px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                required\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                পাসওয়ার্ড\n              </label>\n              <input\n                type=\"password\"\n                value={formData.password}\n                onChange={(e) =>\n                  setFormData({ ...formData, password: e.target.value })\n                }\n                className=\"w-full text-black px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                required\n              />\n            </div>\n\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition disabled:bg-green-400\"\n            >\n              {loading ? \"লগইন হচ্ছে...\" : \"লগইন\"}\n            </button>\n\n            <div className=\"text-center space-y-2\">\n              <Link\n                href=\"/member/forgot-password\"\n                className=\"block text-sm text-green-600 hover:underline\"\n              >\n                পাসওয়ার্ড ভুলে গেছেন?\n              </Link>\n              <Link\n                href=\"/member/register\"\n                className=\"block text-sm text-green-600 hover:underline\"\n              >\n                নতুন সদস্য নিবন্ধন করুন\n              </Link>\n              <Link\n                href=\"/\"\n                className=\"block text-sm text-gray-600 hover:underline\"\n              >\n                ← হোমে ফিরে যান\n              </Link>\n            </div>\n          </form>\n        </div>\n      </div>\n    </>\n  );\n}\n","size_bytes":4197},"pages/chairman/dashboard.tsx":{"content":"import { useEffect, useState } from 'react'\nimport Head from 'next/head'\nimport { useRouter } from 'next/router'\n\nexport default function ChairmanDashboard() {\n  const router = useRouter()\n  const [user, setUser] = useState<any>(null)\n  const [activeTab, setActiveTab] = useState('members')\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    fetchUser()\n  }, [])\n\n  const fetchUser = async () => {\n    try {\n      const res = await fetch('/api/auth/me')\n      if (!res.ok) {\n        router.push('/chairman/login')\n        return\n      }\n      const data = await res.json()\n      if (data.user.role !== 'chairman') {\n        router.push('/')\n        return\n      }\n      setUser(data.user)\n    } catch (error) {\n      router.push('/chairman/login')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleLogout = async () => {\n    await fetch('/api/auth/logout', { method: 'POST' })\n    router.push('/')\n  }\n\n  if (loading) {\n    return <div className=\"min-h-screen flex items-center justify-center\">\n      <div className=\"text-center\">\n        <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\n        <p className=\"mt-4 text-gray-600\">Loading...</p>\n      </div>\n    </div>\n  }\n\n  return (\n    <>\n      <Head>\n        <title>Chairman Dashboard - Bhavki Membership Manager</title>\n      </Head>\n      <div className=\"min-h-screen bg-gray-50\">\n        <nav className=\"bg-white shadow-sm\">\n          <div className=\"max-w-7xl mx-auto px-4 py-4 flex justify-between items-center\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-900\">Chairman Dashboard</h1>\n              <p className=\"text-sm text-gray-600\">Welcome, {user?.name}</p>\n            </div>\n            <button\n              onClick={handleLogout}\n              className=\"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition\"\n            >\n              Logout\n            </button>\n          </div>\n        </nav>\n\n        <div className=\"max-w-7xl mx-auto px-4 py-8\">\n          <div className=\"bg-white rounded-lg shadow\">\n            <div className=\"border-b border-gray-200\">\n              <nav className=\"flex -mb-px\">\n                {['members', 'payments', 'investments', 'audit'].map((tab) => (\n                  <button\n                    key={tab}\n                    onClick={() => setActiveTab(tab)}\n                    className={`px-6 py-4 border-b-2 font-medium text-sm ${\n                      activeTab === tab\n                        ? 'border-blue-500 text-blue-600'\n                        : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                    }`}\n                  >\n                    {tab.charAt(0).toUpperCase() + tab.slice(1)}\n                  </button>\n                ))}\n              </nav>\n            </div>\n\n            <div className=\"p-6\">\n              {activeTab === 'members' && <MembersTab />}\n              {activeTab === 'payments' && <PaymentsTab />}\n              {activeTab === 'investments' && <InvestmentsTab />}\n              {activeTab === 'audit' && <AuditTab />}\n            </div>\n          </div>\n        </div>\n      </div>\n    </>\n  )\n}\n\nfunction MembersTab() {\n  const [view, setView] = useState<'list' | 'generate' | 'create'>('list')\n  const [members, setMembers] = useState<any[]>([])\n  const [search, setSearch] = useState('')\n  const [loading, setLoading] = useState(false)\n  const [message, setMessage] = useState<{ type: 'success' | 'error', text: string} | null>(null)\n  const [selectedMember, setSelectedMember] = useState<any>(null)\n  const [showEditModal, setShowEditModal] = useState(false)\n\n  useEffect(() => {\n    if (view === 'list') {\n      fetchMembers()\n    }\n  }, [view, search])\n\n  const fetchMembers = async () => {\n    setLoading(true)\n    try {\n      const res = await fetch(`/api/members?search=${encodeURIComponent(search)}`)\n      const data = await res.json()\n      setMembers(data.members || [])\n    } catch (error) {\n      showMessage('error', 'Failed to load members')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const showMessage = (type: 'success' | 'error', text: string) => {\n    setMessage({ type, text })\n    setTimeout(() => setMessage(null), 5000)\n  }\n\n  const handleDeleteMember = async (memberId: string) => {\n    if (!confirm('Are you sure? This will delete the member and all their payments permanently.')) return\n    \n    try {\n      const res = await fetch(`/api/members/${memberId}`, { method: 'DELETE' })\n      if (res.ok) {\n        showMessage('success', 'Member deleted successfully')\n        fetchMembers()\n      } else {\n        const data = await res.json()\n        showMessage('error', data.error || 'Failed to delete member')\n      }\n    } catch (error) {\n      showMessage('error', 'Failed to delete member')\n    }\n  }\n\n  return (\n    <div>\n      {message && (\n        <div className={`mb-4 p-4 rounded ${message.type === 'success' ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'}`}>\n          {message.text}\n        </div>\n      )}\n\n      <div className=\"flex justify-between items-center mb-6\">\n        <h2 className=\"text-2xl font-bold text-gray-900\">Member Management</h2>\n        <div className=\"space-x-2\">\n          <button\n            onClick={() => setView('list')}\n            className={`px-4 py-2 rounded ${view === 'list' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}\n          >\n            Member List\n          </button>\n          <button\n            onClick={() => setView('generate')}\n            className={`px-4 py-2 rounded ${view === 'generate' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}\n          >\n            Generate IDs\n          </button>\n          <button\n            onClick={() => setView('create')}\n            className={`px-4 py-2 rounded ${view === 'create' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}\n          >\n            Create Member\n          </button>\n        </div>\n      </div>\n\n      {view === 'list' && (\n        <div>\n          <div className=\"mb-4\">\n            <input\n              type=\"text\"\n              placeholder=\"Search by name or membership ID...\"\n              value={search}\n              onChange={(e) => setSearch(e.target.value)}\n              className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          {loading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\n            </div>\n          ) : members.length === 0 ? (\n            <div className=\"text-center py-8 text-gray-500\">\n              No members found. Create your first member!\n            </div>\n          ) : (\n            <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n              {members.map((member) => (\n                <div key={member.id} className=\"border rounded-lg p-4 hover:shadow-lg transition\">\n                  <div className=\"flex justify-between items-start mb-2\">\n                    <div>\n                      <h3 className=\"font-bold text-lg\">{member.name}</h3>\n                      <p className=\"text-sm text-gray-600\">{member.membershipId}</p>\n                    </div>\n                    <span className={`px-2 py-1 text-xs rounded ${\n                      member.shareType === 'fullShare' ? 'bg-green-100 text-green-800' : 'bg-blue-100 text-blue-800'\n                    }`}>\n                      {member.shareType === 'fullShare' ? 'Full Share' : 'New Member'}\n                    </span>\n                  </div>\n                  <div className=\"text-sm text-gray-600 space-y-1 mb-3\">\n                    <p>Father: {member.fatherName}</p>\n                    <p>Mobile: {member.mobile}</p>\n                    <p>Payments: {member.payments?.length || 0}</p>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={() => {\n                        setSelectedMember(member)\n                        setShowEditModal(true)\n                      }}\n                      className=\"flex-1 bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700\"\n                    >\n                      Edit\n                    </button>\n                    <button\n                      onClick={() => handleDeleteMember(member.id)}\n                      className=\"flex-1 bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700\"\n                    >\n                      Delete\n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n\n      {view === 'generate' && <GenerateMembershipIDs showMessage={showMessage} />}\n      {view === 'create' && <CreateMemberForm showMessage={showMessage} onSuccess={() => setView('list')} />}\n      \n      {showEditModal && selectedMember && (\n        <EditMemberModal\n          member={selectedMember}\n          onClose={() => {\n            setShowEditModal(false)\n            setSelectedMember(null)\n          }}\n          onSuccess={() => {\n            setShowEditModal(false)\n            setSelectedMember(null)\n            showMessage('success', 'Member updated successfully')\n            fetchMembers()\n          }}\n        />\n      )}\n    </div>\n  )\n}\n\nfunction GenerateMembershipIDs({ showMessage }: any) {\n  const [count, setCount] = useState(1)\n  const [generating, setGenerating] = useState(false)\n  const [generatedIds, setGeneratedIds] = useState<string[]>([])\n\n  const handleGenerate = async () => {\n    setGenerating(true)\n    try {\n      const res = await fetch('/api/membership-ids/generate', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ count })\n      })\n      const data = await res.json()\n      if (res.ok) {\n        setGeneratedIds(data.membershipIds.map((m: any) => m.membershipId))\n        showMessage('success', `Generated ${data.membershipIds.length} membership ID(s)`)\n      } else {\n        showMessage('error', data.error || 'Failed to generate IDs')\n      }\n    } catch (error) {\n      showMessage('error', 'Failed to generate IDs')\n    } finally {\n      setGenerating(false)\n    }\n  }\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      <h3 className=\"text-xl font-bold mb-4\">Generate Membership IDs</h3>\n      <div className=\"bg-gray-50 p-6 rounded-lg\">\n        <div className=\"mb-4\">\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n            Number of IDs to Generate (1-100)\n          </label>\n          <input\n            type=\"number\"\n            min=\"1\"\n            max=\"100\"\n            value={count}\n            onChange={(e) => setCount(Math.min(100, Math.max(1, parseInt(e.target.value) || 1)))}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n        <button\n          onClick={handleGenerate}\n          disabled={generating}\n          className=\"w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400\"\n        >\n          {generating ? 'Generating...' : `Generate ${count} ID(s)`}\n        </button>\n      </div>\n\n      {generatedIds.length > 0 && (\n        <div className=\"mt-6\">\n          <h4 className=\"font-bold mb-2\">Generated IDs:</h4>\n          <div className=\"bg-white border rounded p-4 max-h-64 overflow-y-auto\">\n            {generatedIds.map((id, index) => (\n              <div key={index} className=\"py-1 font-mono text-sm\">{id}</div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}\n\nfunction CreateMemberForm({ showMessage, onSuccess }: any) {\n  const [formData, setFormData] = useState({\n    membershipId: '',\n    name: '',\n    fatherName: '',\n    mobile: '',\n    email: '',\n    password: '',\n    shareType: 'newMember'\n  })\n  const [creating, setCreating] = useState(false)\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setCreating(true)\n    try {\n      const res = await fetch('/api/members', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(formData)\n      })\n      const data = await res.json()\n      if (res.ok) {\n        showMessage('success', 'Member created successfully')\n        onSuccess()\n      } else {\n        showMessage('error', data.error || 'Failed to create member')\n      }\n    } catch (error) {\n      showMessage('error', 'Failed to create member')\n    } finally {\n      setCreating(false)\n    }\n  }\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      <h3 className=\"text-xl font-bold mb-4\">Create New Member</h3>\n      <form onSubmit={handleSubmit} className=\"bg-gray-50 p-6 rounded-lg space-y-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Membership ID *</label>\n          <input\n            type=\"text\"\n            required\n            value={formData.membershipId}\n            onChange={(e) => setFormData({...formData, membershipId: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            placeholder=\"BM-XXXXX-XXXX\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Name *</label>\n          <input\n            type=\"text\"\n            required\n            value={formData.name}\n            onChange={(e) => setFormData({...formData, name: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Father's Name *</label>\n          <input\n            type=\"text\"\n            required\n            value={formData.fatherName}\n            onChange={(e) => setFormData({...formData, fatherName: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Mobile *</label>\n          <input\n            type=\"tel\"\n            required\n            value={formData.mobile}\n            onChange={(e) => setFormData({...formData, mobile: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            placeholder=\"01XXXXXXXXX\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Email (Optional)</label>\n          <input\n            type=\"email\"\n            value={formData.email}\n            onChange={(e) => setFormData({...formData, email: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            placeholder=\"member@example.com\"\n          />\n          <p className=\"text-xs text-gray-600 mt-1\">\n            Required for password reset functionality\n          </p>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Password *</label>\n          <input\n            type=\"password\"\n            required\n            value={formData.password}\n            onChange={(e) => setFormData({...formData, password: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Share Type *</label>\n          <select\n            value={formData.shareType}\n            onChange={(e) => setFormData({...formData, shareType: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n          >\n            <option value=\"newMember\">New Member</option>\n            <option value=\"fullShare\">Full Share (New but Full Share)</option>\n          </select>\n          <p className=\"text-xs text-gray-600 mt-1\">\n            Full Share members will have automatic upfront payment calculated\n          </p>\n        </div>\n\n        <button\n          type=\"submit\"\n          disabled={creating}\n          className=\"w-full bg-blue-600 text-white px-4 py-3 rounded hover:bg-blue-700 disabled:bg-gray-400 font-medium\"\n        >\n          {creating ? 'Creating...' : 'Create Member'}\n        </button>\n      </form>\n    </div>\n  )\n}\n\nfunction EditMemberModal({ member, onClose, onSuccess }: any) {\n  const [formData, setFormData] = useState({\n    name: member.name,\n    fatherName: member.fatherName,\n    mobile: member.mobile,\n    email: member.email || ''\n  })\n  const [saving, setSaving] = useState(false)\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setSaving(true)\n    try {\n      const res = await fetch(`/api/members/${member.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify(formData)\n      })\n      if (res.ok) {\n        onSuccess()\n      }\n    } catch (error) {\n      alert('Failed to update member')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-lg max-w-md w-full p-6\">\n        <h3 className=\"text-xl font-bold mb-4\">Edit Member</h3>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Name</label>\n            <input\n              type=\"text\"\n              required\n              value={formData.name}\n              onChange={(e) => setFormData({...formData, name: e.target.value})}\n              className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Father's Name</label>\n            <input\n              type=\"text\"\n              required\n              value={formData.fatherName}\n              onChange={(e) => setFormData({...formData, fatherName: e.target.value})}\n              className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Mobile</label>\n            <input\n              type=\"tel\"\n              required\n              value={formData.mobile}\n              onChange={(e) => setFormData({...formData, mobile: e.target.value})}\n              className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Email (Optional)</label>\n            <input\n              type=\"email\"\n              value={formData.email}\n              onChange={(e) => setFormData({...formData, email: e.target.value})}\n              className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n              placeholder=\"member@example.com\"\n            />\n          </div>\n\n          <div className=\"flex gap-2\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"flex-1 px-4 py-2 border rounded hover:bg-gray-50\"\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              disabled={saving}\n              className=\"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400\"\n            >\n              {saving ? 'Saving...' : 'Save Changes'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  )\n}\n\nfunction PaymentsTab() {\n  const [view, setView] = useState<'list' | 'create' | 'bulk'>('list')\n  const [payments, setPayments] = useState<any[]>([])\n  const [loading, setLoading] = useState(false)\n  const [message, setMessage] = useState<{ type: 'success' | 'error', text: string} | null>(null)\n  const [selectedPayment, setSelectedPayment] = useState<any>(null)\n  const [showEditModal, setShowEditModal] = useState(false)\n\n  useEffect(() => {\n    if (view === 'list') {\n      fetchPayments()\n    }\n  }, [view])\n\n  const fetchPayments = async () => {\n    setLoading(true)\n    try {\n      const res = await fetch('/api/payments')\n      const data = await res.json()\n      setPayments(data.payments || [])\n    } catch (error) {\n      showMessage('error', 'Failed to load payments')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const showMessage = (type: 'success' | 'error', text: string) => {\n    setMessage({ type, text })\n    setTimeout(() => setMessage(null), 5000)\n  }\n\n  return (\n    <div>\n      {message && (\n        <div className={`mb-4 p-4 rounded ${message.type === 'success' ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'}`}>\n          {message.text}\n        </div>\n      )}\n\n      <div className=\"flex justify-between items-center mb-6\">\n        <h2 className=\"text-2xl font-bold text-gray-900\">Payment Management</h2>\n        <div className=\"space-x-2\">\n          <button\n            onClick={() => setView('list')}\n            className={`px-4 py-2 rounded ${view === 'list' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}\n          >\n            Payment List\n          </button>\n          <button\n            onClick={() => setView('create')}\n            className={`px-4 py-2 rounded ${view === 'create' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}\n          >\n            Single Payment\n          </button>\n          <button\n            onClick={() => setView('bulk')}\n            className={`px-4 py-2 rounded ${view === 'bulk' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}\n          >\n            Bulk Payments\n          </button>\n        </div>\n      </div>\n\n      {view === 'list' && (\n        <div>\n          {loading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\n            </div>\n          ) : payments.length === 0 ? (\n            <div className=\"text-center py-8 text-gray-500\">\n              No payments recorded yet\n            </div>\n          ) : (\n            <div className=\"overflow-x-auto\">\n              <table className=\"min-w-full bg-white border\">\n                <thead className=\"bg-gray-50\">\n                  <tr>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Member</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Date</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Amount</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Method</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Transaction #</th>\n                    <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase\">Actions</th>\n                  </tr>\n                </thead>\n                <tbody className=\"divide-y divide-gray-200\">\n                  {payments.map((payment) => (\n                    <tr key={payment.id} className=\"hover:bg-gray-50\">\n                      <td className=\"px-6 py-4 whitespace-nowrap\">\n                        <div className=\"text-sm font-medium text-gray-900\">{payment.member?.name}</div>\n                        <div className=\"text-sm text-gray-500\">{payment.membershipId}</div>\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                        {new Date(payment.date).toLocaleDateString()}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                        {payment.amount} BDT\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-900\">\n                        {payment.paymentFrom}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                        {payment.transactionNumber || 'N/A'}\n                      </td>\n                      <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                        <button\n                          onClick={() => {\n                            setSelectedPayment(payment)\n                            setShowEditModal(true)\n                          }}\n                          className=\"text-blue-600 hover:text-blue-900\"\n                        >\n                          Edit\n                        </button>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          )}\n        </div>\n      )}\n\n      {view === 'create' && <CreatePaymentForm showMessage={showMessage} onSuccess={() => setView('list')} />}\n      {view === 'bulk' && <BulkPaymentForm showMessage={showMessage} onSuccess={() => setView('list')} />}\n      \n      {showEditModal && selectedPayment && (\n        <EditPaymentModal\n          payment={selectedPayment}\n          onClose={() => {\n            setShowEditModal(false)\n            setSelectedPayment(null)\n          }}\n          onSuccess={() => {\n            setShowEditModal(false)\n            setSelectedPayment(null)\n            showMessage('success', 'Payment updated successfully')\n            fetchPayments()\n          }}\n        />\n      )}\n    </div>\n  )\n}\n\nfunction CreatePaymentForm({ showMessage, onSuccess }: any) {\n  const [formData, setFormData] = useState({\n    membershipId: '',\n    amount: '',\n    date: new Date().toISOString().split('T')[0],\n    paymentFrom: 'bKash',\n    transactionNumber: ''\n  })\n  const [creating, setCreating] = useState(false)\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setCreating(true)\n    try {\n      const res = await fetch('/api/payments', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          ...formData,\n          amount: parseFloat(formData.amount),\n          transactionNumber: formData.transactionNumber || null\n        })\n      })\n      const data = await res.json()\n      if (res.ok) {\n        showMessage('success', 'Payment recorded successfully')\n        onSuccess()\n      } else {\n        showMessage('error', data.error || 'Failed to record payment')\n      }\n    } catch (error) {\n      showMessage('error', 'Failed to record payment')\n    } finally {\n      setCreating(false)\n    }\n  }\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      <h3 className=\"text-xl font-bold mb-4\">Record Payment</h3>\n      <form onSubmit={handleSubmit} className=\"bg-gray-50 p-6 rounded-lg space-y-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Membership ID *</label>\n          <input\n            type=\"text\"\n            required\n            value={formData.membershipId}\n            onChange={(e) => setFormData({...formData, membershipId: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            placeholder=\"BM-XXXXX-XXXX\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Amount (BDT) *</label>\n          <input\n            type=\"number\"\n            required\n            min=\"0\"\n            step=\"0.01\"\n            value={formData.amount}\n            onChange={(e) => setFormData({...formData, amount: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Payment Date *</label>\n          <input\n            type=\"date\"\n            required\n            value={formData.date}\n            onChange={(e) => setFormData({...formData, date: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Payment Method *</label>\n          <select\n            value={formData.paymentFrom}\n            onChange={(e) => setFormData({...formData, paymentFrom: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n          >\n            <option value=\"bKash\">bKash</option>\n            <option value=\"Nagad\">Nagad</option>\n            <option value=\"Bank\">Bank</option>\n            <option value=\"Cash\">Cash</option>\n          </select>\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Transaction Number (Optional)</label>\n          <input\n            type=\"text\"\n            value={formData.transactionNumber}\n            onChange={(e) => setFormData({...formData, transactionNumber: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            placeholder=\"TXN123456\"\n          />\n        </div>\n\n        <button\n          type=\"submit\"\n          disabled={creating}\n          className=\"w-full bg-blue-600 text-white px-4 py-3 rounded hover:bg-blue-700 disabled:bg-gray-400 font-medium\"\n        >\n          {creating ? 'Recording...' : 'Record Payment'}\n        </button>\n      </form>\n    </div>\n  )\n}\n\nfunction EditPaymentModal({ payment, onClose, onSuccess }: any) {\n  const [formData, setFormData] = useState({\n    amount: payment.amount,\n    date: new Date(payment.date).toISOString().split('T')[0],\n    paymentFrom: payment.paymentFrom,\n    transactionNumber: payment.transactionNumber || ''\n  })\n  const [saving, setSaving] = useState(false)\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setSaving(true)\n    try {\n      const res = await fetch(`/api/payments/${payment.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          ...formData,\n          amount: parseFloat(formData.amount.toString()),\n          transactionNumber: formData.transactionNumber || null\n        })\n      })\n      if (res.ok) {\n        onSuccess()\n      }\n    } catch (error) {\n      alert('Failed to update payment')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-lg max-w-md w-full p-6\">\n        <h3 className=\"text-xl font-bold mb-4\">Edit Payment</h3>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Amount (BDT)</label>\n            <input\n              type=\"number\"\n              required\n              min=\"0\"\n              step=\"0.01\"\n              value={formData.amount}\n              onChange={(e) => setFormData({...formData, amount: parseFloat(e.target.value)})}\n              className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Payment Date</label>\n            <input\n              type=\"date\"\n              required\n              value={formData.date}\n              onChange={(e) => setFormData({...formData, date: e.target.value})}\n              className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Payment Method</label>\n            <select\n              value={formData.paymentFrom}\n              onChange={(e) => setFormData({...formData, paymentFrom: e.target.value})}\n              className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            >\n              <option value=\"bKash\">bKash</option>\n              <option value=\"Nagad\">Nagad</option>\n              <option value=\"Bank\">Bank</option>\n              <option value=\"Cash\">Cash</option>\n            </select>\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Transaction Number</label>\n            <input\n              type=\"text\"\n              value={formData.transactionNumber}\n              onChange={(e) => setFormData({...formData, transactionNumber: e.target.value})}\n              className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n              placeholder=\"TXN123456\"\n            />\n          </div>\n\n          <div className=\"flex gap-2\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"flex-1 px-4 py-2 border rounded hover:bg-gray-50\"\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              disabled={saving}\n              className=\"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400\"\n            >\n              {saving ? 'Saving...' : 'Save Changes'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  )\n}\n\nfunction BulkPaymentForm({ showMessage, onSuccess }: any) {\n  const [rows, setRows] = useState([\n    { membershipId: '', amount: '', date: new Date().toISOString().split('T')[0], paymentFrom: 'bKash', transactionNumber: '' }\n  ])\n  const [creating, setCreating] = useState(false)\n\n  const addRow = () => {\n    setRows([...rows, { membershipId: '', amount: '', date: new Date().toISOString().split('T')[0], paymentFrom: 'bKash', transactionNumber: '' }])\n  }\n\n  const removeRow = (index: number) => {\n    if (rows.length > 1) {\n      setRows(rows.filter((_, i) => i !== index))\n    }\n  }\n\n  const updateRow = (index: number, field: string, value: string) => {\n    const newRows = [...rows]\n    newRows[index] = { ...newRows[index], [field]: value }\n    setRows(newRows)\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setCreating(true)\n    \n    try {\n      let successCount = 0\n      let errorCount = 0\n      \n      for (const row of rows) {\n        if (!row.membershipId || !row.amount) continue\n        \n        try {\n          const res = await fetch('/api/payments', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              membershipId: row.membershipId,\n              amount: parseFloat(row.amount),\n              date: row.date,\n              paymentFrom: row.paymentFrom,\n              transactionNumber: row.transactionNumber || null\n            })\n          })\n          \n          if (res.ok) {\n            successCount++\n          } else {\n            errorCount++\n          }\n        } catch (error) {\n          errorCount++\n        }\n      }\n      \n      if (successCount > 0) {\n        showMessage('success', `Successfully recorded ${successCount} payment(s)${errorCount > 0 ? `. ${errorCount} failed.` : ''}`)\n        onSuccess()\n      } else {\n        showMessage('error', 'Failed to record payments')\n      }\n    } catch (error) {\n      showMessage('error', 'Failed to record payments')\n    } finally {\n      setCreating(false)\n    }\n  }\n\n  return (\n    <div>\n      <h3 className=\"text-xl font-bold mb-4\">Bulk Payment Entry</h3>\n      <p className=\"text-sm text-gray-600 mb-4\">Record multiple payments at once. All rows with Membership ID and Amount will be saved.</p>\n      <form onSubmit={handleSubmit} className=\"bg-gray-50 p-6 rounded-lg\">\n        <div className=\"overflow-x-auto mb-4\">\n          <table className=\"min-w-full bg-white border\">\n            <thead className=\"bg-gray-100\">\n              <tr>\n                <th className=\"px-2 py-2 text-left text-xs font-medium text-gray-700\">Membership ID *</th>\n                <th className=\"px-2 py-2 text-left text-xs font-medium text-gray-700\">Amount *</th>\n                <th className=\"px-2 py-2 text-left text-xs font-medium text-gray-700\">Date *</th>\n                <th className=\"px-2 py-2 text-left text-xs font-medium text-gray-700\">Method *</th>\n                <th className=\"px-2 py-2 text-left text-xs font-medium text-gray-700\">Transaction #</th>\n                <th className=\"px-2 py-2 text-left text-xs font-medium text-gray-700\"></th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-gray-200\">\n              {rows.map((row, index) => (\n                <tr key={index}>\n                  <td className=\"px-2 py-2\">\n                    <input\n                      type=\"text\"\n                      value={row.membershipId}\n                      onChange={(e) => updateRow(index, 'membershipId', e.target.value)}\n                      className=\"w-full px-2 py-1 border rounded text-sm focus:ring-2 focus:ring-blue-500\"\n                      placeholder=\"BM-XXX\"\n                    />\n                  </td>\n                  <td className=\"px-2 py-2\">\n                    <input\n                      type=\"number\"\n                      min=\"0\"\n                      step=\"0.01\"\n                      value={row.amount}\n                      onChange={(e) => updateRow(index, 'amount', e.target.value)}\n                      className=\"w-full px-2 py-1 border rounded text-sm focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </td>\n                  <td className=\"px-2 py-2\">\n                    <input\n                      type=\"date\"\n                      value={row.date}\n                      onChange={(e) => updateRow(index, 'date', e.target.value)}\n                      className=\"w-full px-2 py-1 border rounded text-sm focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </td>\n                  <td className=\"px-2 py-2\">\n                    <select\n                      value={row.paymentFrom}\n                      onChange={(e) => updateRow(index, 'paymentFrom', e.target.value)}\n                      className=\"w-full px-2 py-1 border rounded text-sm focus:ring-2 focus:ring-blue-500\"\n                    >\n                      <option value=\"bKash\">bKash</option>\n                      <option value=\"Nagad\">Nagad</option>\n                      <option value=\"Bank\">Bank</option>\n                      <option value=\"Cash\">Cash</option>\n                    </select>\n                  </td>\n                  <td className=\"px-2 py-2\">\n                    <input\n                      type=\"text\"\n                      value={row.transactionNumber}\n                      onChange={(e) => updateRow(index, 'transactionNumber', e.target.value)}\n                      className=\"w-full px-2 py-1 border rounded text-sm focus:ring-2 focus:ring-blue-500\"\n                      placeholder=\"TXN123\"\n                    />\n                  </td>\n                  <td className=\"px-2 py-2\">\n                    <button\n                      type=\"button\"\n                      onClick={() => removeRow(index)}\n                      disabled={rows.length === 1}\n                      className=\"text-red-600 hover:text-red-900 text-sm disabled:text-gray-300\"\n                    >\n                      Remove\n                    </button>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n        \n        <div className=\"flex gap-2\">\n          <button\n            type=\"button\"\n            onClick={addRow}\n            className=\"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700\"\n          >\n            Add Row\n          </button>\n          <button\n            type=\"submit\"\n            disabled={creating}\n            className=\"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400 font-medium\"\n          >\n            {creating ? 'Recording Payments...' : `Record ${rows.filter(r => r.membershipId && r.amount).length} Payment(s)`}\n          </button>\n        </div>\n      </form>\n    </div>\n  )\n}\n\nfunction InvestmentsTab() {\n  const [view, setView] = useState<'list' | 'create'>('list')\n  const [investments, setInvestments] = useState<any[]>([])\n  const [loading, setLoading] = useState(false)\n  const [message, setMessage] = useState<{ type: 'success' | 'error', text: string} | null>(null)\n  const [selectedInvestment, setSelectedInvestment] = useState<any>(null)\n  const [showEditModal, setShowEditModal] = useState(false)\n\n  useEffect(() => {\n    if (view === 'list') {\n      fetchInvestments()\n    }\n  }, [view])\n\n  const fetchInvestments = async () => {\n    setLoading(true)\n    try {\n      const res = await fetch('/api/investments')\n      const data = await res.json()\n      setInvestments(data.investments || [])\n    } catch (error) {\n      showMessage('error', 'Failed to load investments')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const showMessage = (type: 'success' | 'error', text: string) => {\n    setMessage({ type, text })\n    setTimeout(() => setMessage(null), 5000)\n  }\n\n  const handleDelete = async (id: string) => {\n    if (!confirm('Are you sure you want to delete this investment?')) return\n    \n    try {\n      const res = await fetch(`/api/investments/${id}`, { method: 'DELETE' })\n      if (res.ok) {\n        showMessage('success', 'Investment deleted successfully')\n        fetchInvestments()\n      } else {\n        showMessage('error', 'Failed to delete investment')\n      }\n    } catch (error) {\n      showMessage('error', 'Failed to delete investment')\n    }\n  }\n\n  return (\n    <div>\n      {message && (\n        <div className={`mb-4 p-4 rounded ${message.type === 'success' ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'}`}>\n          {message.text}\n        </div>\n      )}\n\n      <div className=\"flex justify-between items-center mb-6\">\n        <h2 className=\"text-2xl font-bold text-gray-900\">Investment Management</h2>\n        <div className=\"space-x-2\">\n          <button\n            onClick={() => setView('list')}\n            className={`px-4 py-2 rounded ${view === 'list' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}\n          >\n            Investment List\n          </button>\n          <button\n            onClick={() => setView('create')}\n            className={`px-4 py-2 rounded ${view === 'create' ? 'bg-blue-600 text-white' : 'bg-gray-200 text-gray-700'}`}\n          >\n            Create Investment\n          </button>\n        </div>\n      </div>\n\n      {view === 'list' && (\n        <div>\n          {loading ? (\n            <div className=\"text-center py-8\">\n              <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\n            </div>\n          ) : investments.length === 0 ? (\n            <div className=\"text-center py-8 text-gray-500\">\n              No investments recorded yet\n            </div>\n          ) : (\n            <div className=\"grid gap-4 md:grid-cols-2\">\n              {investments.map((investment) => (\n                <div key={investment.id} className=\"border rounded-lg p-4 hover:shadow-lg transition\">\n                  <div className=\"flex justify-between items-start mb-2\">\n                    <h3 className=\"font-bold text-lg\">{investment.title}</h3>\n                    <span className=\"text-lg font-bold text-green-600\">{investment.amount} BDT</span>\n                  </div>\n                  <p className=\"text-sm text-gray-600 mb-2\">{investment.description}</p>\n                  <div className=\"text-xs text-gray-500 space-y-1 mb-3\">\n                    <p>Purpose: {investment.purpose}</p>\n                    <p>Date: {new Date(investment.date).toLocaleDateString()}</p>\n                  </div>\n                  <div className=\"flex gap-2\">\n                    <button\n                      onClick={() => {\n                        setSelectedInvestment(investment)\n                        setShowEditModal(true)\n                      }}\n                      className=\"flex-1 bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700\"\n                    >\n                      Edit\n                    </button>\n                    <button\n                      onClick={() => handleDelete(investment.id)}\n                      className=\"flex-1 bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700\"\n                    >\n                      Delete\n                    </button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n\n      {view === 'create' && <CreateInvestmentForm showMessage={showMessage} onSuccess={() => setView('list')} />}\n      \n      {showEditModal && selectedInvestment && (\n        <EditInvestmentModal\n          investment={selectedInvestment}\n          onClose={() => {\n            setShowEditModal(false)\n            setSelectedInvestment(null)\n          }}\n          onSuccess={() => {\n            setShowEditModal(false)\n            setSelectedInvestment(null)\n            showMessage('success', 'Investment updated successfully')\n            fetchInvestments()\n          }}\n        />\n      )}\n    </div>\n  )\n}\n\nfunction CreateInvestmentForm({ showMessage, onSuccess }: any) {\n  const [formData, setFormData] = useState({\n    title: '',\n    description: '',\n    amount: '',\n    date: new Date().toISOString().split('T')[0],\n    purpose: ''\n  })\n  const [creating, setCreating] = useState(false)\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setCreating(true)\n    try {\n      const res = await fetch('/api/investments', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          ...formData,\n          amount: parseFloat(formData.amount)\n        })\n      })\n      const data = await res.json()\n      if (res.ok) {\n        showMessage('success', 'Investment created successfully')\n        onSuccess()\n      } else {\n        showMessage('error', data.error || 'Failed to create investment')\n      }\n    } catch (error) {\n      showMessage('error', 'Failed to create investment')\n    } finally {\n      setCreating(false)\n    }\n  }\n\n  return (\n    <div className=\"max-w-2xl mx-auto\">\n      <h3 className=\"text-xl font-bold mb-4\">Create Investment</h3>\n      <form onSubmit={handleSubmit} className=\"bg-gray-50 p-6 rounded-lg space-y-4\">\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Title *</label>\n          <input\n            type=\"text\"\n            required\n            value={formData.title}\n            onChange={(e) => setFormData({...formData, title: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Description *</label>\n          <textarea\n            required\n            value={formData.description}\n            onChange={(e) => setFormData({...formData, description: e.target.value})}\n            rows={3}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Amount (BDT) *</label>\n          <input\n            type=\"number\"\n            required\n            min=\"0\"\n            step=\"0.01\"\n            value={formData.amount}\n            onChange={(e) => setFormData({...formData, amount: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Date *</label>\n          <input\n            type=\"date\"\n            required\n            value={formData.date}\n            onChange={(e) => setFormData({...formData, date: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n          />\n        </div>\n\n        <div>\n          <label className=\"block text-sm font-medium text-gray-700 mb-2\">Purpose *</label>\n          <input\n            type=\"text\"\n            required\n            value={formData.purpose}\n            onChange={(e) => setFormData({...formData, purpose: e.target.value})}\n            className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            placeholder=\"e.g., Business expansion, Equipment purchase\"\n          />\n        </div>\n\n        <button\n          type=\"submit\"\n          disabled={creating}\n          className=\"w-full bg-blue-600 text-white px-4 py-3 rounded hover:bg-blue-700 disabled:bg-gray-400 font-medium\"\n        >\n          {creating ? 'Creating...' : 'Create Investment'}\n        </button>\n      </form>\n    </div>\n  )\n}\n\nfunction EditInvestmentModal({ investment, onClose, onSuccess }: any) {\n  const [formData, setFormData] = useState({\n    title: investment.title,\n    description: investment.description,\n    amount: investment.amount,\n    date: new Date(investment.date).toISOString().split('T')[0],\n    purpose: investment.purpose\n  })\n  const [saving, setSaving] = useState(false)\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setSaving(true)\n    try {\n      const res = await fetch(`/api/investments/${investment.id}`, {\n        method: 'PUT',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          ...formData,\n          amount: parseFloat(formData.amount.toString())\n        })\n      })\n      if (res.ok) {\n        onSuccess()\n      }\n    } catch (error) {\n      alert('Failed to update investment')\n    } finally {\n      setSaving(false)\n    }\n  }\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-lg max-w-md w-full p-6 max-h-[90vh] overflow-y-auto\">\n        <h3 className=\"text-xl font-bold mb-4\">Edit Investment</h3>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Title</label>\n            <input\n              type=\"text\"\n              required\n              value={formData.title}\n              onChange={(e) => setFormData({...formData, title: e.target.value})}\n              className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Description</label>\n            <textarea\n              required\n              value={formData.description}\n              onChange={(e) => setFormData({...formData, description: e.target.value})}\n              rows={3}\n              className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Amount (BDT)</label>\n            <input\n              type=\"number\"\n              required\n              min=\"0\"\n              step=\"0.01\"\n              value={formData.amount}\n              onChange={(e) => setFormData({...formData, amount: parseFloat(e.target.value)})}\n              className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Date</label>\n            <input\n              type=\"date\"\n              required\n              value={formData.date}\n              onChange={(e) => setFormData({...formData, date: e.target.value})}\n              className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          <div>\n            <label className=\"block text-sm font-medium text-gray-700 mb-2\">Purpose</label>\n            <input\n              type=\"text\"\n              required\n              value={formData.purpose}\n              onChange={(e) => setFormData({...formData, purpose: e.target.value})}\n              className=\"w-full px-4 py-2 border rounded focus:ring-2 focus:ring-blue-500\"\n            />\n          </div>\n\n          <div className=\"flex gap-2\">\n            <button\n              type=\"button\"\n              onClick={onClose}\n              className=\"flex-1 px-4 py-2 border rounded hover:bg-gray-50\"\n            >\n              Cancel\n            </button>\n            <button\n              type=\"submit\"\n              disabled={saving}\n              className=\"flex-1 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:bg-gray-400\"\n            >\n              {saving ? 'Saving...' : 'Save Changes'}\n            </button>\n          </div>\n        </form>\n      </div>\n    </div>\n  )\n}\n\nfunction AuditTab() {\n  const [logs, setLogs] = useState<any[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    fetchLogs()\n  }, [])\n\n  const fetchLogs = async () => {\n    try {\n      const res = await fetch('/api/audit-logs')\n      const data = await res.json()\n      setLogs(data.logs || [])\n    } catch (error) {\n      console.error('Failed to load audit logs')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <div>\n      <h2 className=\"text-2xl font-bold text-gray-900 mb-6\">Audit History</h2>\n      \n      {loading ? (\n        <div className=\"text-center py-8\">\n          <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\n        </div>\n      ) : logs.length === 0 ? (\n        <div className=\"text-center py-8 text-gray-500\">\n          No audit history yet\n        </div>\n      ) : (\n        <div className=\"space-y-4\">\n          {logs.map((log) => (\n            <div key={log.id} className=\"border rounded-lg p-4 hover:shadow-lg transition\">\n              <div className=\"flex justify-between items-start mb-2\">\n                <div>\n                  <span className={`px-2 py-1 text-xs rounded font-medium ${\n                    log.action.includes('DELETE') ? 'bg-red-100 text-red-800' :\n                    log.action.includes('CREATE') ? 'bg-green-100 text-green-800' :\n                    'bg-blue-100 text-blue-800'\n                  }`}>\n                    {log.action}\n                  </span>\n                  <p className=\"mt-2 text-sm font-medium text-gray-900\">{log.summary}</p>\n                </div>\n                <span className=\"text-xs text-gray-500\">\n                  {new Date(log.createdAt).toLocaleString()}\n                </span>\n              </div>\n              {log.metadata && (\n                <div className=\"mt-2 text-xs text-gray-600 bg-gray-50 p-2 rounded\">\n                  <pre className=\"whitespace-pre-wrap\">{JSON.stringify(log.metadata, null, 2)}</pre>\n                </div>\n              )}\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  )\n}\n","size_bytes":55400},"styles/globals.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n:root {\n  --foreground-rgb: 0, 0, 0;\n  --background-start-rgb: 214, 219, 220;\n  --background-end-rgb: 255, 255, 255;\n}\n\n@media (prefers-color-scheme: dark) {\n  :root {\n    --foreground-rgb: 255, 255, 255;\n    --background-start-rgb: 0, 0, 0;\n    --background-end-rgb: 0, 0, 0;\n  }\n}\n\nbody {\n  color: rgb(var(--foreground-rgb));\n  background: linear-gradient(\n      to bottom,\n      transparent,\n      rgb(var(--background-end-rgb))\n    )\n    rgb(var(--background-start-rgb));\n}\n\n@layer utilities {\n  .text-balance {\n    text-wrap: balance;\n  }\n}\n","size_bytes":606},"pages/api/auth/me.ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport { prisma } from '@/lib/prisma'\nimport { verifyAuth } from '@/lib/auth'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ error: 'Method not allowed' })\n  }\n\n  const auth = verifyAuth(req)\n  if (!auth) {\n    return res.status(401).json({ error: 'Unauthorized' })\n  }\n\n  try {\n    const user = await prisma.user.findUnique({\n      where: { id: auth.userId },\n      select: {\n        id: true,\n        membershipId: true,\n        name: true,\n        fatherName: true,\n        mobile: true,\n        role: true,\n        shareType: true,\n        createdAt: true,\n      },\n    })\n\n    if (!user) {\n      return res.status(404).json({ error: 'User not found' })\n    }\n\n    return res.status(200).json({ user })\n  } catch (error) {\n    console.error('Get current user error:', error)\n    return res.status(500).json({ error: 'Internal server error' })\n  }\n}\n","size_bytes":1020},"pages/api/investments/index.ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport { prisma } from '@/lib/prisma'\nimport { requireAuth } from '@/lib/auth'\nimport { createInvestmentSchema } from '@/lib/validation'\nimport { createAuditLog } from '@/lib/audit'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method === 'GET') {\n    const auth = requireAuth(req, res)\n    if (!auth) return\n\n    try {\n      const { page = 1, limit = 20 } = req.query\n      const skip = (Number(page) - 1) * Number(limit)\n\n      const [investments, total] = await Promise.all([\n        prisma.investment.findMany({\n          skip,\n          take: Number(limit),\n          orderBy: { date: 'desc' },\n        }),\n        prisma.investment.count(),\n      ])\n\n      return res.status(200).json({\n        investments,\n        pagination: {\n          total,\n          page: Number(page),\n          limit: Number(limit),\n          pages: Math.ceil(total / Number(limit)),\n        },\n      })\n    } catch (error) {\n      console.error('Get investments error:', error)\n      return res.status(500).json({ error: 'Internal server error' })\n    }\n  }\n\n  if (req.method === 'POST') {\n    const auth = requireAuth(req, res, ['chairman'])\n    if (!auth) return\n\n    try {\n      const validation = createInvestmentSchema.safeParse(req.body)\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error.errors[0].message })\n      }\n\n      const { title, description, amount, date, purpose } = validation.data\n\n      const investment = await prisma.investment.create({\n        data: {\n          title,\n          description,\n          amount,\n          date: new Date(date),\n          purpose,\n          createdBy: auth.userId,\n        },\n      })\n\n      await createAuditLog(\n        'INVESTMENT_CREATED',\n        auth.userId,\n        'Investment',\n        investment.id,\n        `Created investment: ${title} - ${amount} BDT`,\n        { title, amount, purpose }\n      )\n\n      return res.status(201).json({ investment })\n    } catch (error) {\n      console.error('Create investment error:', error)\n      return res.status(500).json({ error: 'Internal server error' })\n    }\n  }\n\n  return res.status(405).json({ error: 'Method not allowed' })\n}\n","size_bytes":2278},"pages/api/reports/share.ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport { requireAuth } from '@/lib/auth'\nimport { calculateAllShares } from '@/lib/share-calculator'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ error: 'Method not allowed' })\n  }\n\n  const auth = requireAuth(req, res)\n  if (!auth) return\n\n  try {\n    const shareCalculations = await calculateAllShares()\n\n    const totalShares = shareCalculations.reduce(\n      (sum, calc) => sum + calc.sharePercentage,\n      0\n    )\n\n    return res.status(200).json({\n      calculations: shareCalculations,\n      totalShares,\n    })\n  } catch (error) {\n    console.error('Get share report error:', error)\n    return res.status(500).json({ error: 'Internal server error' })\n  }\n}\n","size_bytes":834},"pages/api/payments/[id].ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport { prisma } from '@/lib/prisma'\nimport { requireAuth } from '@/lib/auth'\nimport { updatePaymentSchema } from '@/lib/validation'\nimport { createAuditLog } from '@/lib/audit'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'PUT') {\n    return res.status(405).json({ error: 'Method not allowed' })\n  }\n\n  const auth = requireAuth(req, res, ['chairman'])\n  if (!auth) return\n\n  const { id } = req.query\n\n  try {\n    const payment = await prisma.payment.findUnique({\n      where: { id: String(id) },\n    })\n\n    if (!payment) {\n      return res.status(404).json({ error: 'Payment not found' })\n    }\n\n    const validation = updatePaymentSchema.safeParse(req.body)\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error.errors[0].message })\n    }\n\n    const updateData: any = { updatedBy: auth.userId }\n    const changes: string[] = []\n\n    if (validation.data.amount !== undefined) {\n      updateData.amount = validation.data.amount\n      changes.push(`amount: ${payment.amount} → ${validation.data.amount}`)\n    }\n    if (validation.data.date) {\n      updateData.date = new Date(validation.data.date)\n      changes.push(`date: ${payment.date} → ${validation.data.date}`)\n    }\n    if (validation.data.paymentFrom) {\n      updateData.paymentFrom = validation.data.paymentFrom\n      changes.push(`paymentFrom: ${payment.paymentFrom} → ${validation.data.paymentFrom}`)\n    }\n    if (validation.data.transactionNumber !== undefined) {\n      updateData.transactionNumber = validation.data.transactionNumber\n      changes.push(`transactionNumber: ${payment.transactionNumber || 'null'} → ${validation.data.transactionNumber}`)\n    }\n\n    const updated = await prisma.payment.update({\n      where: { id: String(id) },\n      data: updateData,\n    })\n\n    await createAuditLog(\n      'PAYMENT_UPDATED',\n      auth.userId,\n      'Payment',\n      payment.id,\n      `Updated payment for ${payment.membershipId} - ${changes.join(', ')}`,\n      { changes }\n    )\n\n    return res.status(200).json({ payment: updated })\n  } catch (error) {\n    console.error('Update payment error:', error)\n    return res.status(500).json({ error: 'Internal server error' })\n  }\n}\n","size_bytes":2317},"pages/chairman/login.tsx":{"content":"import { useState } from \"react\";\nimport Head from \"next/head\";\nimport { useRouter } from \"next/router\";\nimport Link from \"next/link\";\n\nexport default function ChairmanLogin() {\n  const router = useRouter();\n  const [formData, setFormData] = useState({ username: \"\", password: \"\" });\n  const [error, setError] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n    setLoading(true);\n\n    try {\n      const res = await fetch(\"/api/auth/chairman/login\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(formData),\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) {\n        throw new Error(data.error || \"Login failed\");\n      }\n\n      router.push(\"/chairman/dashboard\");\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <>\n      <Head>\n        <title>Chairman Login - Bhavki Membership Manager</title>\n      </Head>\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4\">\n        <div className=\"bg-white rounded-lg shadow-xl p-8 w-full max-w-md\">\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-3xl font-bold text-gray-900\">Chairman Login</h1>\n            <p className=\"text-gray-600 mt-2\">Access the admin dashboard</p>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {error && (\n              <div className=\"bg-red-50 text-red-800 p-3 rounded border border-red-200\">\n                {error}\n              </div>\n            )}\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Username\n              </label>\n              <input\n                type=\"text\"\n                value={formData.username}\n                onChange={(e) =>\n                  setFormData({ ...formData, username: e.target.value })\n                }\n                className=\"w-full px-4 py-2 text-black border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                required\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Password\n              </label>\n              <input\n                type=\"password\"\n                value={formData.password}\n                onChange={(e) =>\n                  setFormData({ ...formData, password: e.target.value })\n                }\n                className=\"w-full text-black px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                required\n              />\n            </div>\n\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition disabled:bg-blue-400\"\n            >\n              {loading ? \"Logging in...\" : \"Login\"}\n            </button>\n\n            <div className=\"text-center\">\n              <Link\n                href=\"/chairman/forgot-password\"\n                className=\"text-sm text-blue-600 hover:underline\"\n              >\n                Forgot Password?\n              </Link>\n            </div>\n\n            <div className=\"text-center\">\n              <Link href=\"/\" className=\"text-sm text-gray-600 hover:underline\">\n                ← Back to Home\n              </Link>\n            </div>\n          </form>\n        </div>\n      </div>\n    </>\n  );\n}\n","size_bytes":3695},"pages/api/members/[id].ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport { prisma } from '@/lib/prisma'\nimport { requireAuth } from '@/lib/auth'\nimport bcrypt from 'bcrypt'\nimport { updateMemberSchema } from '@/lib/validation'\nimport { createAuditLog } from '@/lib/audit'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  const { id } = req.query\n\n  if (req.method === 'GET') {\n    const auth = requireAuth(req, res)\n    if (!auth) return\n\n    try {\n      const member = await prisma.user.findFirst({\n        where: {\n          id: String(id),\n          isDeleted: false,\n        },\n        include: {\n          payments: {\n            orderBy: { date: 'desc' },\n          },\n        },\n      })\n\n      if (!member) {\n        return res.status(404).json({ error: 'Member not found' })\n      }\n\n      if (auth.role === 'member' && member.id !== auth.userId) {\n        return res.status(403).json({ error: 'Forbidden' })\n      }\n\n      const { passwordHash, ...memberData } = member\n      return res.status(200).json({ member: memberData })\n    } catch (error) {\n      console.error('Get member error:', error)\n      return res.status(500).json({ error: 'Internal server error' })\n    }\n  }\n\n  if (req.method === 'PUT') {\n    const auth = requireAuth(req, res)\n    if (!auth) return\n\n    try {\n      const member = await prisma.user.findFirst({\n        where: { id: String(id), isDeleted: false },\n      })\n\n      if (!member) {\n        return res.status(404).json({ error: 'Member not found' })\n      }\n\n      if (auth.role === 'member' && member.id !== auth.userId) {\n        return res.status(403).json({ error: 'Forbidden' })\n      }\n\n      const validation = updateMemberSchema.safeParse(req.body)\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error.errors[0].message })\n      }\n\n      const updateData: any = {}\n      const changes: string[] = []\n\n      if (validation.data.name) {\n        updateData.name = validation.data.name\n        changes.push(`name: ${member.name} → ${validation.data.name}`)\n      }\n      if (validation.data.fatherName) {\n        updateData.fatherName = validation.data.fatherName\n        changes.push(`fatherName: ${member.fatherName} → ${validation.data.fatherName}`)\n      }\n      if (validation.data.mobile) {\n        updateData.mobile = validation.data.mobile\n        changes.push(`mobile: ${member.mobile} → ${validation.data.mobile}`)\n      }\n      if (validation.data.password) {\n        updateData.passwordHash = await bcrypt.hash(validation.data.password, 10)\n        changes.push('password updated')\n      }\n\n      const updated = await prisma.user.update({\n        where: { id: String(id) },\n        data: updateData,\n      })\n\n      await createAuditLog(\n        'MEMBER_UPDATED',\n        auth.userId,\n        'User',\n        member.id,\n        `Updated member: ${member.membershipId} - ${changes.join(', ')}`,\n        { changes }\n      )\n\n      const { passwordHash, ...memberData } = updated\n      return res.status(200).json({ member: memberData })\n    } catch (error) {\n      console.error('Update member error:', error)\n      return res.status(500).json({ error: 'Internal server error' })\n    }\n  }\n\n  if (req.method === 'DELETE') {\n    const auth = requireAuth(req, res, ['chairman'])\n    if (!auth) return\n\n    try {\n      const member = await prisma.user.findFirst({\n        where: { id: String(id), role: 'member', isDeleted: false },\n      })\n\n      if (!member) {\n        return res.status(404).json({ error: 'Member not found' })\n      }\n\n      await prisma.$transaction([\n        prisma.user.update({\n          where: { id: String(id) },\n          data: { isDeleted: true },\n        }),\n        prisma.membershipId.update({\n          where: { membershipId: member.membershipId },\n          data: { isDeleted: true },\n        }),\n      ])\n\n      await createAuditLog(\n        'MEMBER_DELETED',\n        auth.userId,\n        'User',\n        member.id,\n        `Deleted member: ${member.name} (${member.membershipId})`,\n        { membershipId: member.membershipId }\n      )\n\n      return res.status(200).json({ message: 'Member deleted successfully' })\n    } catch (error) {\n      console.error('Delete member error:', error)\n      return res.status(500).json({ error: 'Internal server error' })\n    }\n  }\n\n  return res.status(405).json({ error: 'Method not allowed' })\n}\n","size_bytes":4410},"tailwind.config.ts":{"content":"import type { Config } from 'tailwindcss'\n\nconst config: Config = {\n  content: [\n    './pages/**/*.{js,ts,jsx,tsx,mdx}',\n    './components/**/*.{js,ts,jsx,tsx,mdx}',\n    './app/**/*.{js,ts,jsx,tsx,mdx}',\n  ],\n  theme: {\n    extend: {\n      colors: {\n        primary: {\n          50: '#f0f9ff',\n          100: '#e0f2fe',\n          200: '#bae6fd',\n          300: '#7dd3fc',\n          400: '#38bdf8',\n          500: '#0ea5e9',\n          600: '#0284c7',\n          700: '#0369a1',\n          800: '#075985',\n          900: '#0c4a6e',\n        },\n      },\n    },\n  },\n  plugins: [],\n}\nexport default config\n","size_bytes":599},"scripts/seed-sample.ts":{"content":"import { PrismaClient } from '@prisma/client'\nimport bcrypt from 'bcrypt'\nimport crypto from 'crypto'\n\nconst prisma = new PrismaClient()\n\nconst generateMembershipId = (): string => {\n  const timestamp = Date.now().toString(36).toUpperCase()\n  const random = crypto.randomBytes(2).toString('hex').toUpperCase()\n  return `BM-${timestamp}-${random}`\n}\n\nasync function main() {\n  const chairman = await prisma.user.findFirst({\n    where: { role: 'chairman' },\n  })\n\n  if (!chairman) {\n    console.error('Chairman account not found. Run seed:init first.')\n    return\n  }\n\n  const passwordHash = await bcrypt.hash('password123', 10)\n\n  const sampleMembers = [\n    { name: 'আব্দুল করিম', fatherName: 'মোহাম্মদ আলী', mobile: '01711111111', shareType: 'fullShare' },\n    { name: 'রহিম উদ্দিন', fatherName: 'করিম উদ্দিন', mobile: '01722222222', shareType: 'fullShare' },\n    { name: 'সালমা খাতুন', fatherName: 'আব্দুল জব্বার', mobile: '01733333333', shareType: 'newMember' },\n    { name: 'মোহাম্মদ জসিম', fatherName: 'আব্দুর রহমান', mobile: '01744444444', shareType: 'fullShare' },\n    { name: 'ফাতেমা বেগম', fatherName: 'মোহাম্মদ আলী', mobile: '01755555555', shareType: 'newMember' },\n  ]\n\n  for (const member of sampleMembers) {\n    const membershipId = generateMembershipId()\n    \n    await prisma.membershipId.create({\n      data: { membershipId },\n    })\n\n    const user = await prisma.user.create({\n      data: {\n        membershipId,\n        name: member.name,\n        fatherName: member.fatherName,\n        mobile: member.mobile,\n        passwordHash,\n        role: 'member',\n        shareType: member.shareType as any,\n      },\n    })\n\n    await prisma.membershipId.update({\n      where: { membershipId },\n      data: { assignedTo: user.id },\n    })\n\n    const paymentCount = Math.floor(Math.random() * 6) + 3\n    for (let i = 0; i < paymentCount; i++) {\n      const date = new Date()\n      date.setMonth(date.getMonth() - (paymentCount - i))\n      \n      await prisma.payment.create({\n        data: {\n          membershipId,\n          amount: 500,\n          date,\n          paymentFrom: ['bKash', 'Nagad', 'Bank'][Math.floor(Math.random() * 3)] as any,\n          transactionNumber: Math.random() > 0.3 ? `TXN${Math.random().toString(36).substring(7).toUpperCase()}` : null,\n          createdById: chairman.id,\n        },\n      })\n    }\n  }\n\n  await prisma.investment.create({\n    data: {\n      title: 'অফিস সরঞ্জাম ক্রয়',\n      description: 'নতুন অফিস কম্পিউটার এবং প্রিন্টার ক্রয়',\n      amount: 50000,\n      date: new Date(),\n      purpose: 'অফিস উন্নয়ন',\n      createdBy: chairman.id,\n    },\n  })\n\n  await prisma.investment.create({\n    data: {\n      title: 'প্রশিক্ষণ কর্মসূচি',\n      description: 'সদস্যদের জন্য দক্ষতা উন্নয়ন প্রশিক্ষণ',\n      amount: 30000,\n      date: new Date(),\n      purpose: 'সদস্য উন্নয়ন',\n      createdBy: chairman.id,\n    },\n  })\n\n  console.log('Sample data created successfully!')\n  console.log(`Created ${sampleMembers.length} members with payments`)\n  console.log('Created 2 investments')\n  console.log('\\nAll members have password: password123')\n}\n\nmain()\n  .then(async () => {\n    await prisma.$disconnect()\n  })\n  .catch(async (e) => {\n    console.error(e)\n    await prisma.$disconnect()\n    process.exit(1)\n  })\n","size_bytes":3717},"pages/member/register.tsx":{"content":"import { useState } from \"react\";\nimport Head from \"next/head\";\nimport { useRouter } from \"next/router\";\nimport Link from \"next/link\";\n\nexport default function MemberRegister() {\n  const router = useRouter();\n  const [formData, setFormData] = useState({\n    membershipId: \"\",\n    name: \"\",\n    fatherName: \"\",\n    mobile: \"\",\n    email: \"\",\n    password: \"\",\n    confirmPassword: \"\",\n  });\n  const [error, setError] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError(\"\");\n\n    if (formData.password !== formData.confirmPassword) {\n      setError(\"পাসওয়ার্ড মিলছে না\");\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      const res = await fetch(\"/api/auth/member/register\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(formData),\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) {\n        throw new Error(data.error || \"Registration failed\");\n      }\n\n      alert(\"নিবন্ধন সফল হয়েছে! এখন লগইন করুন।\");\n      router.push(\"/member/login\");\n    } catch (err: any) {\n      setError(err.message);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <>\n      <Head>\n        <title>সদস্য নিবন্ধন - Bhavki Membership Manager</title>\n      </Head>\n      <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 py-12 px-4\">\n        <div className=\"bg-white rounded-lg shadow-xl p-8 w-full max-w-2xl mx-auto\">\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-3xl font-bold text-gray-900\">সদস্য নিবন্ধন</h1>\n            <p className=\"text-gray-600 mt-2\">নতুন অ্যাকাউন্ট তৈরি করুন</p>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {error && (\n              <div className=\"bg-red-50 text-red-800 p-3 rounded border border-red-200\">\n                {error}\n              </div>\n            )}\n\n            <div className=\"grid md:grid-cols-2 gap-6\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  মেম্বারশিপ আইডি *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.membershipId}\n                  onChange={(e) =>\n                    setFormData({ ...formData, membershipId: e.target.value })\n                  }\n                  className=\"w-full text-black px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  নাম *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.name}\n                  onChange={(e) =>\n                    setFormData({ ...formData, name: e.target.value })\n                  }\n                  className=\"w-full text-black px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  পিতার নাম *\n                </label>\n                <input\n                  type=\"text\"\n                  value={formData.fatherName}\n                  onChange={(e) =>\n                    setFormData({ ...formData, fatherName: e.target.value })\n                  }\n                  className=\"w-full text-black px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  মোবাইল নম্বর *\n                </label>\n                <input\n                  type=\"tel\"\n                  value={formData.mobile}\n                  onChange={(e) =>\n                    setFormData({ ...formData, mobile: e.target.value })\n                  }\n                  placeholder=\"01XXXXXXXXX\"\n                  className=\"w-full text-black px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  ইমেইল (ঐচ্ছিক)\n                </label>\n                <input\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={(e) =>\n                    setFormData({ ...formData, email: e.target.value })\n                  }\n                  placeholder=\"your-email@example.com\"\n                  className=\"w-full text-black px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">পাসওয়ার্ড রিসেট এর জন্য প্রয়োজন</p>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  পাসওয়ার্ড *\n                </label>\n                <input\n                  type=\"password\"\n                  value={formData.password}\n                  onChange={(e) =>\n                    setFormData({ ...formData, password: e.target.value })\n                  }\n                  className=\"w-full text-black px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                  required\n                  minLength={6}\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                  পাসওয়ার্ড নিশ্চিত করুন *\n                </label>\n                <input\n                  type=\"password\"\n                  value={formData.confirmPassword}\n                  onChange={(e) =>\n                    setFormData({\n                      ...formData,\n                      confirmPassword: e.target.value,\n                    })\n                  }\n                  className=\"w-full text-black px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                  required\n                  minLength={6}\n                />\n              </div>\n            </div>\n\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition disabled:bg-green-400\"\n            >\n              {loading ? \"নিবন্ধন হচ্ছে...\" : \"নিবন্ধন করুন\"}\n            </button>\n\n            <div className=\"text-center space-y-2\">\n              <Link\n                href=\"/member/login\"\n                className=\"block text-sm text-green-600 hover:underline\"\n              >\n                ইতিমধ্যে অ্যাকাউন্ট আছে? লগইন করুন\n              </Link>\n              <Link\n                href=\"/\"\n                className=\"block text-sm text-gray-600 hover:underline\"\n              >\n                ← হোমে ফিরে যান\n              </Link>\n            </div>\n          </form>\n        </div>\n      </div>\n    </>\n  );\n}\n","size_bytes":7984},"pages/api/payments/member/[membershipId].ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport { prisma } from '@/lib/prisma'\nimport { requireAuth } from '@/lib/auth'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ error: 'Method not allowed' })\n  }\n\n  const auth = requireAuth(req, res)\n  if (!auth) return\n\n  const { membershipId } = req.query\n\n  try {\n    const member = await prisma.user.findFirst({\n      where: {\n        membershipId: String(membershipId),\n        role: 'member',\n        isDeleted: false,\n      },\n    })\n\n    if (!member) {\n      return res.status(404).json({ error: 'Member not found' })\n    }\n\n    if (auth.role === 'member' && member.membershipId !== auth.membershipId) {\n      return res.status(403).json({ error: 'Forbidden' })\n    }\n\n    const payments = await prisma.payment.findMany({\n      where: { membershipId: String(membershipId) },\n      orderBy: { date: 'asc' },\n    })\n\n    return res.status(200).json({ payments })\n  } catch (error) {\n    console.error('Get member payments error:', error)\n    return res.status(500).json({ error: 'Internal server error' })\n  }\n}\n","size_bytes":1184},"pages/index.tsx":{"content":"import Head from 'next/head'\nimport Link from 'next/link'\n\nexport default function Home() {\n  return (\n    <>\n      <Head>\n        <title>Bhavki Membership Manager</title>\n        <meta name=\"description\" content=\"Membership management system\" />\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />\n      </Head>\n      <main className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4 sm:px-6 lg:px-8\">\n        <div className=\"max-w-7xl mx-auto\">\n          <div className=\"text-center mb-12\">\n            <h1 className=\"text-5xl font-bold text-gray-900 mb-4\">\n              Bhavki Membership Manager\n            </h1>\n            <p className=\"text-xl text-gray-600\">\n              Complete membership and investment management system\n            </p>\n          </div>\n\n          <div className=\"grid md:grid-cols-2 gap-8 max-w-4xl mx-auto\">\n            <Link \n              href=\"/chairman/login\"\n              className=\"bg-white rounded-lg shadow-lg p-8 hover:shadow-xl transition-shadow border-2 border-transparent hover:border-blue-500\"\n            >\n              <div className=\"text-center\">\n                <div className=\"bg-blue-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4\">\n                  <svg className=\"w-10 h-10 text-blue-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\" />\n                  </svg>\n                </div>\n                <h2 className=\"text-2xl font-bold text-gray-900 mb-2\">Chairman Login</h2>\n                <p className=\"text-gray-600\">\n                  Access the admin dashboard to manage members, payments, and investments\n                </p>\n              </div>\n            </Link>\n\n            <div className=\"bg-white rounded-lg shadow-lg p-8\">\n              <div className=\"text-center\">\n                <div className=\"bg-green-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4\">\n                  <svg className=\"w-10 h-10 text-green-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z\" />\n                  </svg>\n                </div>\n                <h2 className=\"text-2xl font-bold text-gray-900 mb-4\">Member Portal</h2>\n                <div className=\"space-y-3\">\n                  <Link \n                    href=\"/member/login\"\n                    className=\"block w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition\"\n                  >\n                    Member Login\n                  </Link>\n                  <Link \n                    href=\"/member/register\"\n                    className=\"block w-full bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300 transition\"\n                  >\n                    Member Register\n                  </Link>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"mt-12 text-center text-gray-600\">\n            <p className=\"text-sm\">\n              Secure membership management with investment tracking and share calculations\n            </p>\n          </div>\n        </div>\n      </main>\n    </>\n  )\n}\n","size_bytes":3628},"pages/api/auth/chairman/login.ts":{"content":"// import type { NextApiRequest, NextApiResponse } from 'next'\n// import bcrypt from 'bcrypt'\n// import { prisma } from '@/lib/prisma'\n// import { generateToken } from '@/lib/jwt'\n// import { setAuthCookie } from '@/lib/auth'\n// import { chairmanLoginSchema } from '@/lib/validation'\n// import { rateLimit } from '@/lib/rate-limiter'\n\n// export default async function handler(\n//   req: NextApiRequest,\n//   res: NextApiResponse\n// ) {\n//   if (req.method !== 'POST') {\n//     return res.status(405).json({ error: 'Method not allowed' })\n//   }\n\n//   if (!rateLimit(req, res)) {\n//     return\n//   }\n\n//   try {\n//     const validation = chairmanLoginSchema.safeParse(req.body)\n//     if (!validation.success) {\n//       return res.status(400).json({ error: validation.error.errors[0].message })\n//     }\n\n//     const { username, password } = validation.data\n\n//     const user = await prisma.user.findFirst({\n//       where: {\n//         membershipId: username,\n//         role: 'chairman',\n//         isDeleted: false,\n//       },\n//     })\n\n//     if (!user) {\n//       return res.status(401).json({ error: 'Invalid credentials' })\n//     }\n\n//     const isValidPassword = await bcrypt.compare(password, user.passwordHash)\n//     if (!isValidPassword) {\n//       return res.status(401).json({ error: 'Invalid credentials' })\n//     }\n\n//     const token = generateToken({\n//       userId: user.id,\n//       membershipId: user.membershipId,\n//       role: user.role,\n//     })\n\n//     setAuthCookie(res, token)\n\n//     return res.status(200).json({\n//       user: {\n//         id: user.id,\n//         name: user.name,\n//         membershipId: user.membershipId,\n//         role: user.role,\n//       },\n//     })\n//   } catch (error) {\n//     console.error('Chairman login error:', error)\n//     return res.status(500).json({ error: 'Internal server error' })\n//   }\n// }\n\nimport type { NextApiRequest, NextApiResponse } from \"next\";\nimport { prisma } from \"@/lib/prisma\";\nimport { generateToken } from \"@/lib/jwt\";\nimport { setAuthCookie } from \"@/lib/auth\";\nimport { chairmanLoginSchema } from \"@/lib/validation\";\nimport { rateLimit } from \"@/lib/rate-limiter\";\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== \"POST\") {\n    return res.status(405).json({ error: \"Method not allowed\" });\n  }\n\n  if (!rateLimit(req, res)) return;\n\n  try {\n    // Validate input\n    const validation = chairmanLoginSchema.safeParse(req.body);\n    if (!validation.success) {\n      return res\n        .status(400)\n        .json({ error: validation.error.errors[0].message });\n    }\n\n    const { username, password } = validation.data;\n\n    // Read chairman credentials from .env\n    const chairmanUsername = process.env.CHAIRMAN_USERNAME;\n    const chairmanPassword = process.env.CHAIRMAN_PASSWORD;\n\n    // Normalize input for case-insensitive match\n    const normalizedUsername = username.trim().toLowerCase();\n\n    if (\n      normalizedUsername !== chairmanUsername?.toLowerCase() ||\n      password !== chairmanPassword\n    ) {\n      return res.status(401).json({ error: \"Invalid credentials\" });\n    }\n\n    // Fetch the chairman user from the database to get the actual user ID\n    const chairmanUser = await prisma.user.findFirst({\n      where: {\n        role: \"chairman\",\n        isDeleted: false,\n      },\n    });\n\n    if (!chairmanUser) {\n      return res.status(500).json({ error: \"Chairman account not found in database\" });\n    }\n\n    // Generate JWT token with the actual database user ID\n    const token = generateToken({\n      userId: chairmanUser.id,\n      membershipId: chairmanUser.membershipId,\n      role: \"chairman\",\n    });\n\n    // Set auth cookie\n    setAuthCookie(res, token);\n\n    return res.status(200).json({\n      user: {\n        id: chairmanUser.id,\n        name: chairmanUser.name,\n        membershipId: chairmanUser.membershipId,\n        role: \"chairman\",\n      },\n    });\n  } catch (error) {\n    console.error(\"Chairman login error:\", error);\n    return res.status(500).json({ error: \"Internal server error\" });\n  }\n}\n","size_bytes":4092},"lib/email.ts":{"content":"import nodemailer from 'nodemailer'\n\nconst transporter = nodemailer.createTransport({\n  host: process.env.SMTP_HOST || 'smtp.gmail.com',\n  port: parseInt(process.env.SMTP_PORT || '587'),\n  secure: false,\n  auth: {\n    user: process.env.SMTP_USER,\n    pass: process.env.SMTP_PASS,\n  },\n})\n\nexport const sendPasswordResetEmail = async (\n  email: string,\n  token: string,\n  name: string\n): Promise<void> => {\n  const resetLink = `${process.env.NEXT_PUBLIC_APP_URL || 'http://localhost:5000'}/chairman/reset-password?token=${token}`\n\n  const mailOptions = {\n    from: process.env.EMAIL_FROM || 'noreply@bhavki.com',\n    to: email,\n    subject: 'Password Reset Request - Bhavki Membership Manager',\n    html: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2>Password Reset Request</h2>\n        <p>Dear ${name},</p>\n        <p>You have requested to reset your password. Click the link below to reset your password:</p>\n        <p>\n          <a href=\"${resetLink}\" style=\"background-color: #0ea5e9; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px; display: inline-block;\">\n            Reset Password\n          </a>\n        </p>\n        <p>This link will expire in 1 hour.</p>\n        <p>If you didn't request this, please ignore this email.</p>\n        <p>Best regards,<br>Bhavki Membership Manager</p>\n      </div>\n    `,\n  }\n\n  try {\n    await transporter.sendMail(mailOptions)\n  } catch (error) {\n    console.error('Failed to send email:', error)\n    throw new Error('Failed to send password reset email')\n  }\n}\n","size_bytes":1587},"lib/validation.ts":{"content":"import { z } from 'zod'\n\nexport const chairmanLoginSchema = z.object({\n  username: z.string().min(1, 'Username is required'),\n  password: z.string().min(6, 'Password must be at least 6 characters'),\n})\n\nexport const memberLoginSchema = z.object({\n  membershipId: z.string().min(1, 'Membership ID is required'),\n  password: z.string().min(6, 'Password must be at least 6 characters'),\n})\n\nexport const memberRegisterSchema = z.object({\n  membershipId: z.string().min(1, 'Membership ID is required'),\n  name: z.string().min(1, 'Name is required'),\n  fatherName: z.string().min(1, \"Father's name is required\"),\n  mobile: z.string().regex(/^01[3-9]\\d{8}$/, 'Invalid mobile number'),\n  email: z.string().email('Invalid email address').optional().or(z.literal('')),\n  password: z.string().min(6, 'Password must be at least 6 characters'),\n  confirmPassword: z.string(),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"Passwords don't match\",\n  path: ['confirmPassword'],\n})\n\nexport const createMemberSchema = z.object({\n  membershipId: z.string().min(1, 'Membership ID is required'),\n  name: z.string().min(1, 'Name is required'),\n  fatherName: z.string().min(1, \"Father's name is required\"),\n  mobile: z.string().min(1, 'Mobile is required'),\n  email: z.string().email('Invalid email address').optional().or(z.literal('')),\n  password: z.string().min(6, 'Password must be at least 6 characters'),\n  shareType: z.enum(['fullShare', 'newMember']),\n})\n\nexport const updateMemberSchema = z.object({\n  name: z.string().min(1).optional(),\n  fatherName: z.string().min(1).optional(),\n  mobile: z.string().min(1).optional(),\n  email: z.string().email('Invalid email address').optional().or(z.literal('')),\n  password: z.string().min(6).optional(),\n})\n\nexport const createPaymentSchema = z.object({\n  membershipId: z.string().min(1, 'Membership ID is required'),\n  amount: z.number().min(0, 'Amount must be positive'),\n  date: z.string(),\n  paymentFrom: z.enum(['bKash', 'Nagad', 'Bank']),\n  transactionNumber: z.string().optional(),\n})\n\nexport const updatePaymentSchema = z.object({\n  amount: z.number().min(0).optional(),\n  date: z.string().optional(),\n  paymentFrom: z.enum(['bKash', 'Nagad', 'Bank']).optional(),\n  transactionNumber: z.string().optional(),\n})\n\nexport const createInvestmentSchema = z.object({\n  title: z.string().min(1, 'Title is required'),\n  description: z.string().min(1, 'Description is required'),\n  amount: z.number().min(0, 'Amount must be positive'),\n  date: z.string(),\n  purpose: z.string().min(1, 'Purpose is required'),\n})\n\nexport const updateInvestmentSchema = z.object({\n  title: z.string().min(1).optional(),\n  description: z.string().min(1).optional(),\n  amount: z.number().min(0).optional(),\n  date: z.string().optional(),\n  purpose: z.string().min(1).optional(),\n  status: z.string().optional(),\n  profitLoss: z.number().optional(),\n  reason: z.string().optional(),\n})\n\nexport const forgotPasswordSchema = z.object({\n  email: z.string().email('Invalid email address'),\n})\n\nexport const resetPasswordSchema = z.object({\n  token: z.string().min(1, 'Token is required'),\n  password: z.string().min(6, 'Password must be at least 6 characters'),\n  confirmPassword: z.string(),\n}).refine((data) => data.password === data.confirmPassword, {\n  message: \"Passwords don't match\",\n  path: ['confirmPassword'],\n})\n","size_bytes":3353},"pages/_app.tsx":{"content":"import '@/styles/globals.css'\nimport type { AppProps } from 'next/app'\n\nexport default function App({ Component, pageProps }: AppProps) {\n  return <Component {...pageProps} />\n}\n","size_bytes":178},"pages/api/members/index.ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport { prisma } from '@/lib/prisma'\nimport { requireAuth } from '@/lib/auth'\nimport bcrypt from 'bcrypt'\nimport { createMemberSchema } from '@/lib/validation'\nimport { createAuditLog } from '@/lib/audit'\nimport { calculateFullShareUpfrontPayment } from '@/lib/share-calculator'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method === 'GET') {\n    const auth = requireAuth(req, res, ['chairman'])\n    if (!auth) return\n\n    try {\n      const { search, page = 1, limit = 20 } = req.query\n      const skip = (Number(page) - 1) * Number(limit)\n\n      const where: any = {\n        role: 'member',\n        isDeleted: false,\n      }\n\n      if (search) {\n        where.OR = [\n          { name: { contains: String(search), mode: 'insensitive' } },\n          { membershipId: { contains: String(search), mode: 'insensitive' } },\n        ]\n      }\n\n      const [members, total] = await Promise.all([\n        prisma.user.findMany({\n          where,\n          skip,\n          take: Number(limit),\n          orderBy: { createdAt: 'desc' },\n          include: {\n            payments: {\n              orderBy: { date: 'asc' },\n            },\n          },\n        }),\n        prisma.user.count({ where }),\n      ])\n\n      return res.status(200).json({\n        members,\n        pagination: {\n          total,\n          page: Number(page),\n          limit: Number(limit),\n          pages: Math.ceil(total / Number(limit)),\n        },\n      })\n    } catch (error) {\n      console.error('Get members error:', error)\n      return res.status(500).json({ error: 'Internal server error' })\n    }\n  }\n\n  if (req.method === 'POST') {\n    const auth = requireAuth(req, res, ['chairman'])\n    if (!auth) return\n\n    try {\n      const validation = createMemberSchema.safeParse(req.body)\n      if (!validation.success) {\n        return res.status(400).json({ error: validation.error.errors[0].message })\n      }\n\n      const { membershipId, name, fatherName, mobile, email, password, shareType } = validation.data\n\n      const membershipIdRecord = await prisma.membershipId.findUnique({\n        where: { membershipId },\n      })\n\n      if (!membershipIdRecord || membershipIdRecord.isDeleted || membershipIdRecord.assignedTo) {\n        return res.status(400).json({ error: 'Invalid or already used membership ID' })\n      }\n\n      if (email && email.trim() !== '') {\n        const existingEmail = await prisma.user.findFirst({\n          where: { email: email.toLowerCase() },\n        })\n        if (existingEmail) {\n          return res.status(400).json({ error: 'Email already in use' })\n        }\n      }\n\n      const passwordHash = await bcrypt.hash(password, 10)\n\n      const member = await prisma.$transaction(async (tx) => {\n        const newMember = await tx.user.create({\n          data: {\n            membershipId,\n            name,\n            fatherName,\n            mobile,\n            email: email && email.trim() !== '' ? email.toLowerCase() : null,\n            passwordHash,\n            role: 'member',\n            shareType,\n          },\n        })\n\n        await tx.membershipId.update({\n          where: { membershipId },\n          data: { assignedTo: newMember.id },\n        })\n\n        if (shareType === 'fullShare') {\n          const upfrontPayment = await calculateFullShareUpfrontPayment()\n          await tx.payment.create({\n            data: {\n              membershipId,\n              amount: upfrontPayment,\n              date: new Date(),\n              paymentFrom: 'Bank',\n              transactionNumber: 'INITIAL-FULL-SHARE',\n              createdById: auth.userId,\n            },\n          })\n        }\n\n        return newMember\n      })\n\n      await createAuditLog(\n        'MEMBER_CREATED',\n        auth.userId,\n        'User',\n        member.id,\n        `Created member: ${name} (${membershipId}) as ${shareType}`,\n        { membershipId, shareType }\n      )\n\n      return res.status(201).json({ member })\n    } catch (error) {\n      console.error('Create member error:', error)\n      return res.status(500).json({ error: 'Internal server error' })\n    }\n  }\n\n  return res.status(405).json({ error: 'Method not allowed' })\n}\n","size_bytes":4245},"pages/api/membership-ids/generate.ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport { prisma } from '@/lib/prisma'\nimport { requireAuth } from '@/lib/auth'\nimport { createAuditLog } from '@/lib/audit'\nimport crypto from 'crypto'\n\nconst generateMembershipId = (): string => {\n  const timestamp = Date.now().toString(36).toUpperCase()\n  const random = crypto.randomBytes(2).toString('hex').toUpperCase()\n  return `BM-${timestamp}-${random}`\n}\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' })\n  }\n\n  const auth = requireAuth(req, res, ['chairman'])\n  if (!auth) return\n\n  try {\n    const { count = 1 } = req.body\n\n    const generateCount = Math.min(Math.max(count, 1), 100)\n    const membershipIds = []\n\n    for (let i = 0; i < generateCount; i++) {\n      const membershipId = generateMembershipId()\n      const created = await prisma.membershipId.create({\n        data: { membershipId },\n      })\n      membershipIds.push(created)\n    }\n\n    await createAuditLog(\n      'MEMBERSHIP_ID_GENERATED',\n      auth.userId,\n      'MembershipId',\n      null,\n      `Generated ${generateCount} membership ID(s)`,\n      { count: generateCount, ids: membershipIds.map(m => m.membershipId) }\n    )\n\n    return res.status(201).json({ membershipIds })\n  } catch (error) {\n    console.error('Generate membership ID error:', error)\n    return res.status(500).json({ error: 'Internal server error' })\n  }\n}\n","size_bytes":1507},"pages/api/auth/member/register.ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport bcrypt from 'bcrypt'\nimport { prisma } from '@/lib/prisma'\nimport { memberRegisterSchema } from '@/lib/validation'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' })\n  }\n\n  try {\n    const validation = memberRegisterSchema.safeParse(req.body)\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error.errors[0].message })\n    }\n\n    const { membershipId, name, fatherName, mobile, email, password } = validation.data\n\n    const membershipIdRecord = await prisma.membershipId.findUnique({\n      where: { membershipId },\n    })\n\n    if (!membershipIdRecord || membershipIdRecord.isDeleted || membershipIdRecord.assignedTo) {\n      return res.status(400).json({ error: 'Invalid or already used membership ID' })\n    }\n\n    const whereConditions: any[] = [{ membershipId }, { mobile }]\n    \n    if (email && email.trim() !== '') {\n      whereConditions.push({ email: email.toLowerCase() })\n    }\n\n    const existingUser = await prisma.user.findFirst({\n      where: {\n        OR: whereConditions,\n      },\n    })\n\n    if (existingUser) {\n      if (existingUser.membershipId === membershipId) {\n        return res.status(400).json({ error: 'Membership ID already in use' })\n      }\n      if (existingUser.mobile === mobile) {\n        return res.status(400).json({ error: 'Mobile number already in use' })\n      }\n      if (email && existingUser.email?.toLowerCase() === email.toLowerCase()) {\n        return res.status(400).json({ error: 'Email already in use' })\n      }\n    }\n\n    const passwordHash = await bcrypt.hash(password, 10)\n\n    const user = await prisma.$transaction(async (tx) => {\n      const newUser = await tx.user.create({\n        data: {\n          membershipId,\n          name,\n          fatherName,\n          mobile,\n          email: email && email.trim() !== '' ? email.toLowerCase() : null,\n          passwordHash,\n          role: 'member',\n          shareType: 'newMember',\n        },\n      })\n\n      await tx.membershipId.update({\n        where: { membershipId },\n        data: { assignedTo: newUser.id },\n      })\n\n      return newUser\n    })\n\n    return res.status(201).json({\n      message: 'Registration successful',\n      user: {\n        id: user.id,\n        name: user.name,\n        membershipId: user.membershipId,\n      },\n    })\n  } catch (error) {\n    console.error('Member registration error:', error)\n    return res.status(500).json({ error: 'Internal server error' })\n  }\n}\n","size_bytes":2640},"pages/api/auth/chairman/forgot-password.ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport { prisma } from '@/lib/prisma'\nimport { generateResetToken } from '@/lib/jwt'\nimport { sendPasswordResetEmail } from '@/lib/email'\nimport { forgotPasswordSchema } from '@/lib/validation'\nimport { rateLimit } from '@/lib/rate-limiter'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' })\n  }\n\n  if (!rateLimit(req, res)) {\n    return\n  }\n\n  try {\n    const validation = forgotPasswordSchema.safeParse(req.body)\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error.errors[0].message })\n    }\n\n    const { email } = validation.data\n\n    const user = await prisma.user.findFirst({\n      where: {\n        email: email.toLowerCase(),\n        role: 'chairman',\n        isDeleted: false,\n      },\n    })\n\n    if (!user || !user.email) {\n      return res.status(200).json({ message: 'If the account exists, a reset email has been sent' })\n    }\n\n    const token = generateResetToken()\n    const expiresAt = new Date(Date.now() + 60 * 60 * 1000)\n\n    await prisma.passwordResetToken.create({\n      data: {\n        userId: user.id,\n        token,\n        expiresAt,\n      },\n    })\n\n    await sendPasswordResetEmail(user.email, token, user.name)\n\n    return res.status(200).json({ message: 'If the account exists, a reset email has been sent' })\n  } catch (error) {\n    console.error('Forgot password error:', error)\n    return res.status(500).json({ error: 'Internal server error' })\n  }\n}\n","size_bytes":1618},"lib/jwt.ts":{"content":"import jwt from 'jsonwebtoken'\nimport crypto from 'crypto'\n\nconst getJWTSecret = (): string => {\n  if (process.env.JWT_SECRET) {\n    return process.env.JWT_SECRET\n  }\n  \n  const generatedSecret = crypto.randomBytes(64).toString('hex')\n  console.log('⚠️  JWT_SECRET not found in environment. Generated temporary secret.')\n  console.log('⚠️  For production, set JWT_SECRET in your .env file')\n  return generatedSecret\n}\n\nconst JWT_SECRET = getJWTSecret()\n\nexport interface JWTPayload {\n  userId: string\n  membershipId: string\n  role: 'chairman' | 'member'\n}\n\nexport const generateToken = (payload: JWTPayload): string => {\n  return jwt.sign(payload, JWT_SECRET, {\n    expiresIn: '7d',\n  })\n}\n\nexport const verifyToken = (token: string): JWTPayload | null => {\n  try {\n    const decoded = jwt.verify(token, JWT_SECRET) as JWTPayload\n    return decoded\n  } catch (error) {\n    return null\n  }\n}\n\nexport const generateResetToken = (): string => {\n  return crypto.randomBytes(32).toString('hex')\n}\n","size_bytes":1000},"server/db.ts":{"content":"import { Pool, neonConfig } from \"@neondatabase/serverless\";\nimport { drizzle } from \"drizzle-orm/neon-serverless\";\nimport ws from \"ws\";\nimport * as schema from \"../lib/prisma\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\"\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":481},"pages/member/dashboard.tsx":{"content":"import { useEffect, useState } from 'react'\nimport Head from 'next/head'\nimport { useRouter } from 'next/router'\nimport { format } from 'date-fns'\n\nexport default function MemberDashboard() {\n  const router = useRouter()\n  const [user, setUser] = useState<any>(null)\n  const [payments, setPayments] = useState<any[]>([])\n  const [investments, setInvestments] = useState<any[]>([])\n  const [loading, setLoading] = useState(true)\n\n  useEffect(() => {\n    fetchData()\n  }, [])\n\n  const fetchData = async () => {\n    try {\n      const userRes = await fetch('/api/auth/me')\n      if (!userRes.ok) {\n        router.push('/member/login')\n        return\n      }\n      const userData = await userRes.json()\n      if (userData.user.role !== 'member') {\n        router.push('/')\n        return\n      }\n      setUser(userData.user)\n\n      const paymentsRes = await fetch(`/api/payments/member/${userData.user.membershipId}`)\n      if (paymentsRes.ok) {\n        const paymentsData = await paymentsRes.json()\n        setPayments(paymentsData.payments)\n      }\n\n      const investmentsRes = await fetch('/api/investments')\n      if (investmentsRes.ok) {\n        const investmentsData = await investmentsRes.json()\n        setInvestments(investmentsData.investments)\n      }\n    } catch (error) {\n      router.push('/member/login')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const handleLogout = async () => {\n    await fetch('/api/auth/logout', { method: 'POST' })\n    router.push('/')\n  }\n\n  if (loading) {\n    return <div className=\"min-h-screen flex items-center justify-center\">লোড হচ্ছে...</div>\n  }\n\n  const totalPaid = payments.reduce((sum, p) => sum + p.amount, 0)\n\n  return (\n    <>\n      <Head>\n        <title>সদস্য ড্যাশবোর্ড - Bhavki Membership Manager</title>\n      </Head>\n      <div className=\"min-h-screen bg-gray-50\">\n        <nav className=\"bg-white shadow-sm\">\n          <div className=\"max-w-7xl mx-auto px-4 py-4 flex justify-between items-center\">\n            <div>\n              <h1 className=\"text-2xl font-bold text-gray-900\">সদস্য ড্যাশবোর্ড</h1>\n              <p className=\"text-sm text-gray-600\">স্বাগতম, {user?.name}</p>\n            </div>\n            <button\n              onClick={handleLogout}\n              className=\"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700\"\n            >\n              লগআউট\n            </button>\n          </div>\n        </nav>\n\n        <div className=\"max-w-7xl mx-auto px-4 py-8\">\n          <div className=\"grid md:grid-cols-3 gap-6 mb-8\">\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <h3 className=\"text-sm font-medium text-gray-600\">মেম্বারশিপ আইডি</h3>\n              <p className=\"text-2xl font-bold text-gray-900 mt-2\">{user?.membershipId}</p>\n            </div>\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <h3 className=\"text-sm font-medium text-gray-600\">মোট পেমেন্ট</h3>\n              <p className=\"text-2xl font-bold text-gray-900 mt-2\">{payments.length}</p>\n            </div>\n            <div className=\"bg-white rounded-lg shadow p-6\">\n              <h3 className=\"text-sm font-medium text-gray-600\">মোট জমা</h3>\n              <p className=\"text-2xl font-bold text-gray-900 mt-2\">৳ {totalPaid}</p>\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-lg shadow p-6 mb-8\">\n            <h2 className=\"text-xl font-bold mb-4\">ব্যক্তিগত তথ্য</h2>\n            <div className=\"grid md:grid-cols-2 gap-4\">\n              <div>\n                <label className=\"text-sm text-gray-600\">নাম</label>\n                <p className=\"font-medium\">{user?.name}</p>\n              </div>\n              <div>\n                <label className=\"text-sm text-gray-600\">পিতার নাম</label>\n                <p className=\"font-medium\">{user?.fatherName}</p>\n              </div>\n              <div>\n                <label className=\"text-sm text-gray-600\">মোবাইল</label>\n                <p className=\"font-medium\">{user?.mobile}</p>\n              </div>\n              <div>\n                <label className=\"text-sm text-gray-600\">শেয়ার টাইপ</label>\n                <p className=\"font-medium\">{user?.shareType === 'fullShare' ? 'ফুল শেয়ার' : 'নতুন সদস্য'}</p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-white rounded-lg shadow p-6 mb-8\">\n            <h2 className=\"text-xl font-bold mb-4\">পেমেন্ট ইতিহাস</h2>\n            {payments.length === 0 ? (\n              <p className=\"text-gray-600\">কোনো পেমেন্ট নেই</p>\n            ) : (\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full\">\n                  <thead>\n                    <tr className=\"border-b\">\n                      <th className=\"text-left py-2\">তারিখ</th>\n                      <th className=\"text-right py-2\">পরিমাণ</th>\n                      <th className=\"text-left py-2\">মাধ্যম</th>\n                      <th className=\"text-left py-2\">লেনদেন নম্বর</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {payments.map((payment) => (\n                      <tr key={payment.id} className=\"border-b\">\n                        <td className=\"py-2\">{format(new Date(payment.date), 'dd/MM/yyyy')}</td>\n                        <td className=\"text-right\">৳ {payment.amount}</td>\n                        <td>{payment.paymentFrom}</td>\n                        <td>{payment.transactionNumber || '-'}</td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            )}\n          </div>\n\n          <div className=\"bg-white rounded-lg shadow p-6\">\n            <h2 className=\"text-xl font-bold mb-4\">বিনিয়োগ</h2>\n            {investments.length === 0 ? (\n              <p className=\"text-gray-600\">কোনো বিনিয়োগ নেই</p>\n            ) : (\n              <div className=\"space-y-4\">\n                {investments.map((investment) => (\n                  <div key={investment.id} className=\"border-l-4 border-blue-500 pl-4\">\n                    <h3 className=\"font-bold\">{investment.title}</h3>\n                    <p className=\"text-sm text-gray-600\">{investment.description}</p>\n                    <div className=\"flex justify-between mt-2\">\n                      <span className=\"text-sm text-gray-600\">{investment.purpose}</span>\n                      <span className=\"font-bold\">৳ {investment.amount}</span>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </>\n  )\n}\n","size_bytes":7016},"next.config.js":{"content":"/** @type {import('next').NextConfig} */\nconst nextConfig = {\n  reactStrictMode: true,\n  poweredByHeader: false,\n  async headers() {\n    return [\n      {\n        source: '/:path*',\n        headers: [\n          {\n            key: 'X-DNS-Prefetch-Control',\n            value: 'on'\n          },\n          {\n            key: 'Strict-Transport-Security',\n            value: 'max-age=63072000; includeSubDomains; preload'\n          },\n          {\n            key: 'X-Frame-Options',\n            value: 'SAMEORIGIN'\n          },\n          {\n            key: 'X-Content-Type-Options',\n            value: 'nosniff'\n          },\n          {\n            key: 'X-XSS-Protection',\n            value: '1; mode=block'\n          },\n          {\n            key: 'Referrer-Policy',\n            value: 'origin-when-cross-origin'\n          }\n        ]\n      }\n    ]\n  }\n}\n\nmodule.exports = nextConfig\n","size_bytes":881},"pages/api/audit-logs/index.ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport { requireAuth } from '@/lib/auth'\nimport { getAuditLogs } from '@/lib/audit'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'GET') {\n    return res.status(405).json({ error: 'Method not allowed' })\n  }\n\n  const auth = requireAuth(req, res, ['chairman'])\n  if (!auth) return\n\n  try {\n    const { page = 1, limit = 50 } = req.query\n    const skip = (Number(page) - 1) * Number(limit)\n\n    const logs = await getAuditLogs(Number(limit), skip)\n\n    return res.status(200).json({ logs })\n  } catch (error) {\n    console.error('Get audit logs error:', error)\n    return res.status(500).json({ error: 'Internal server error' })\n  }\n}\n","size_bytes":758},".local/state/replit/agent/progress_tracker.md":{"content":"[x] 1. Install the required packages\n[x] 2. Restart the workflow to see if the project is working\n[x] 3. Verify the project is working\n[x] 4. Fixed chairman login JWT token issues\n[x] 5. Built complete functional Chairman Dashboard with:\n    - Members Tab (Generate IDs, Create/Edit/Delete Members, Search)\n    - Payments Tab (Create/Edit Payments)\n    - Investments Tab (Create/Edit/Delete Investments)\n    - Audit History Tab (View all chairman actions)\n[x] 6. Updated Prisma schema with email field and investment profit/loss tracking\n[x] 7. Updated validation schemas to support email and investment updates\n[ ] 8. Create forgot password functionality for chairman and members\n[ ] 9. Update member registration and add member forms with email field\n[ ] 10. Fix all UI visibility issues\n[ ] 11. Implement remaining features and test thoroughly","size_bytes":846},"pages/chairman/forgot-password.tsx":{"content":"import { useState } from 'react'\nimport Head from 'next/head'\nimport Link from 'next/link'\n\nexport default function ChairmanForgotPassword() {\n  const [email, setEmail] = useState('')\n  const [message, setMessage] = useState('')\n  const [error, setError] = useState('')\n  const [loading, setLoading] = useState(false)\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setError('')\n    setMessage('')\n    setLoading(true)\n\n    try {\n      const res = await fetch('/api/auth/chairman/forgot-password', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email }),\n      })\n\n      const data = await res.json()\n\n      if (!res.ok) {\n        throw new Error(data.error || 'Failed to send reset email')\n      }\n\n      setMessage(data.message)\n      setEmail('')\n    } catch (err: any) {\n      setError(err.message)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <>\n      <Head>\n        <title>Forgot Password - Chairman</title>\n      </Head>\n      <div className=\"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4\">\n        <div className=\"bg-white rounded-lg shadow-xl p-8 w-full max-w-md\">\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-3xl font-bold text-gray-900\">Reset Password</h1>\n            <p className=\"text-gray-600 mt-2\">Chairman Account</p>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {message && (\n              <div className=\"bg-green-50 text-green-800 p-3 rounded border border-green-200\">\n                {message}\n              </div>\n            )}\n\n            {error && (\n              <div className=\"bg-red-50 text-red-800 p-3 rounded border border-red-200\">\n                {error}\n              </div>\n            )}\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Enter your email address\n              </label>\n              <input\n                type=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                className=\"w-full px-4 py-2 text-black border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n                placeholder=\"chairman@bhavki.com\"\n                required\n              />\n              <p className=\"text-sm text-gray-500 mt-2\">\n                We'll send a password reset link to this email address.\n              </p>\n            </div>\n\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition disabled:bg-blue-400\"\n            >\n              {loading ? 'Sending...' : 'Send Reset Link'}\n            </button>\n\n            <div className=\"text-center\">\n              <Link\n                href=\"/chairman/login\"\n                className=\"text-sm text-blue-600 hover:underline\"\n              >\n                ← Back to Login\n              </Link>\n            </div>\n          </form>\n        </div>\n      </div>\n    </>\n  )\n}\n","size_bytes":3203},"pages/api/auth/member/forgot-password.ts":{"content":"import type { NextApiRequest, NextApiResponse } from 'next'\nimport { prisma } from '@/lib/prisma'\nimport { generateResetToken } from '@/lib/jwt'\nimport { sendPasswordResetEmail } from '@/lib/email'\nimport { forgotPasswordSchema } from '@/lib/validation'\nimport { rateLimit } from '@/lib/rate-limiter'\n\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' })\n  }\n\n  if (!rateLimit(req, res)) {\n    return\n  }\n\n  try {\n    const validation = forgotPasswordSchema.safeParse(req.body)\n    if (!validation.success) {\n      return res.status(400).json({ error: validation.error.errors[0].message })\n    }\n\n    const { email } = validation.data\n\n    const user = await prisma.user.findFirst({\n      where: {\n        email: email.toLowerCase(),\n        role: 'member',\n        isDeleted: false,\n      },\n    })\n\n    if (!user || !user.email) {\n      return res.status(200).json({ message: 'If the account exists, a reset email has been sent' })\n    }\n\n    const token = generateResetToken()\n    const expiresAt = new Date(Date.now() + 60 * 60 * 1000)\n\n    await prisma.passwordResetToken.create({\n      data: {\n        userId: user.id,\n        token,\n        expiresAt,\n      },\n    })\n\n    await sendPasswordResetEmail(user.email, token, user.name)\n\n    return res.status(200).json({ message: 'If the account exists, a reset email has been sent' })\n  } catch (error) {\n    console.error('Forgot password error:', error)\n    return res.status(500).json({ error: 'Internal server error' })\n  }\n}\n","size_bytes":1616},"pages/reset-password.tsx":{"content":"import { useState } from 'react'\nimport Head from 'next/head'\nimport Link from 'next/link'\nimport { useRouter } from 'next/router'\n\nexport default function ResetPassword() {\n  const router = useRouter()\n  const { token } = router.query\n\n  const [formData, setFormData] = useState({\n    password: '',\n    confirmPassword: '',\n  })\n  const [message, setMessage] = useState('')\n  const [error, setError] = useState('')\n  const [loading, setLoading] = useState(false)\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setError('')\n    setMessage('')\n\n    if (formData.password !== formData.confirmPassword) {\n      setError(\"Passwords don't match\")\n      return\n    }\n\n    setLoading(true)\n\n    try {\n      const res = await fetch('/api/auth/reset-password', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          token,\n          password: formData.password,\n          confirmPassword: formData.confirmPassword,\n        }),\n      })\n\n      const data = await res.json()\n\n      if (!res.ok) {\n        throw new Error(data.error || 'Failed to reset password')\n      }\n\n      setMessage('Password reset successful! Redirecting to login...')\n      setTimeout(() => {\n        router.push('/')\n      }, 2000)\n    } catch (err: any) {\n      setError(err.message)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  if (!token) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-4\">\n        <div className=\"bg-white rounded-lg shadow-xl p-8 text-center\">\n          <h1 className=\"text-2xl font-bold text-gray-900 mb-4\">Invalid Reset Link</h1>\n          <p className=\"text-gray-600 mb-6\">This password reset link is invalid or expired.</p>\n          <Link href=\"/\" className=\"text-blue-600 hover:underline\">\n            Go to Home\n          </Link>\n        </div>\n      </div>\n    )\n  }\n\n  return (\n    <>\n      <Head>\n        <title>Reset Password - Bhavki Membership Manager</title>\n      </Head>\n      <div className=\"min-h-screen bg-gradient-to-br from-purple-50 to-pink-100 flex items-center justify-center p-4\">\n        <div className=\"bg-white rounded-lg shadow-xl p-8 w-full max-w-md\">\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-3xl font-bold text-gray-900\">Reset Password</h1>\n            <p className=\"text-gray-600 mt-2\">Enter your new password</p>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {message && (\n              <div className=\"bg-green-50 text-green-800 p-3 rounded border border-green-200\">\n                {message}\n              </div>\n            )}\n\n            {error && (\n              <div className=\"bg-red-50 text-red-800 p-3 rounded border border-red-200\">\n                {error}\n              </div>\n            )}\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                New Password\n              </label>\n              <input\n                type=\"password\"\n                value={formData.password}\n                onChange={(e) =>\n                  setFormData({ ...formData, password: e.target.value })\n                }\n                className=\"w-full px-4 py-2 text-black border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                required\n                minLength={6}\n              />\n            </div>\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Confirm New Password\n              </label>\n              <input\n                type=\"password\"\n                value={formData.confirmPassword}\n                onChange={(e) =>\n                  setFormData({ ...formData, confirmPassword: e.target.value })\n                }\n                className=\"w-full px-4 py-2 text-black border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent\"\n                required\n                minLength={6}\n              />\n            </div>\n\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition disabled:bg-purple-400\"\n            >\n              {loading ? 'Resetting...' : 'Reset Password'}\n            </button>\n\n            <div className=\"text-center\">\n              <Link href=\"/\" className=\"text-sm text-gray-600 hover:underline\">\n                ← Back to Home\n              </Link>\n            </div>\n          </form>\n        </div>\n      </div>\n    </>\n  )\n}\n","size_bytes":4705},"pages/member/forgot-password.tsx":{"content":"import { useState } from 'react'\nimport Head from 'next/head'\nimport Link from 'next/link'\n\nexport default function MemberForgotPassword() {\n  const [email, setEmail] = useState('')\n  const [message, setMessage] = useState('')\n  const [error, setError] = useState('')\n  const [loading, setLoading] = useState(false)\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setError('')\n    setMessage('')\n    setLoading(true)\n\n    try {\n      const res = await fetch('/api/auth/member/forgot-password', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email }),\n      })\n\n      const data = await res.json()\n\n      if (!res.ok) {\n        throw new Error(data.error || 'Failed to send reset email')\n      }\n\n      setMessage(data.message)\n      setEmail('')\n    } catch (err: any) {\n      setError(err.message)\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <>\n      <Head>\n        <title>পাসওয়ার্ড রিসেট - সদস্য</title>\n      </Head>\n      <div className=\"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center p-4\">\n        <div className=\"bg-white rounded-lg shadow-xl p-8 w-full max-w-md\">\n          <div className=\"text-center mb-8\">\n            <h1 className=\"text-3xl font-bold text-gray-900\">পাসওয়ার্ড রিসেট</h1>\n            <p className=\"text-gray-600 mt-2\">আপনার পাসওয়ার্ড পুনরুদ্ধার করুন</p>\n          </div>\n\n          <form onSubmit={handleSubmit} className=\"space-y-6\">\n            {message && (\n              <div className=\"bg-green-50 text-green-800 p-3 rounded border border-green-200\">\n                {message}\n              </div>\n            )}\n\n            {error && (\n              <div className=\"bg-red-50 text-red-800 p-3 rounded border border-red-200\">\n                {error}\n              </div>\n            )}\n\n            <div>\n              <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                আপনার ইমেইল ঠিকানা লিখুন\n              </label>\n              <input\n                type=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                className=\"w-full px-4 py-2 text-black border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent\"\n                placeholder=\"your-email@example.com\"\n                required\n              />\n              <p className=\"text-sm text-gray-500 mt-2\">\n                আমরা এই ইমেইল ঠিকানায় একটি পাসওয়ার্ড রিসেট লিংক পাঠাব।\n              </p>\n            </div>\n\n            <button\n              type=\"submit\"\n              disabled={loading}\n              className=\"w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition disabled:bg-green-400\"\n            >\n              {loading ? 'পাঠানো হচ্ছে...' : 'রিসেট লিংক পাঠান'}\n            </button>\n\n            <div className=\"text-center\">\n              <Link\n                href=\"/member/login\"\n                className=\"text-sm text-green-600 hover:underline\"\n              >\n                ← লগইনে ফিরে যান\n              </Link>\n            </div>\n          </form>\n        </div>\n      </div>\n    </>\n  )\n}\n","size_bytes":3571}},"version":2}